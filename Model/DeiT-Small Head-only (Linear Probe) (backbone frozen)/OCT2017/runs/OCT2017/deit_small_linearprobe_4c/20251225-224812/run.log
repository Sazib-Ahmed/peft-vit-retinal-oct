
=== DATASET RUN START: OCT2017 ===

[DATA] Split/Class counts:
class    CNV   DME  DRUSEN  NORMAL  TOTAL
split                                    
test     250   250     250     250   1000
train  28285  9819    7000   45054  90158
val     3142  1091     777    5006  10016
[DATA] Train imbalance: min=7000, max=45054, ratio=6.44
[RAM] Caching split='train' images=90158 as uint8 tensors. Estimated RAM ~ 12.64 GB
[RAM] Cached 90158 images for split='train'
[RAM] Caching split='val' images=10016 as uint8 tensors. Estimated RAM ~ 1.40 GB
[RAM] Cached 10016 images for split='val'
[RAM] Caching split='test' images=1000 as uint8 tensors. Estimated RAM ~ 0.14 GB
[RAM] Cached 1000 images for split='test'
[IMB] Train class counts: [28285, 9819, 7000, 45054]
[IMB] Class-Balanced weights (mean~1): [0.7512, 1.1301, 1.404, 0.7147]
[IMB] Sampler disabled. min=7000 max=45054 ratio=6.44

[DATASET] OCT2017
 - root: D:\AIUB\DSP\Code\Datasets\ZhangLabData\OCT2017_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (4): ['CNV', 'DME', 'DRUSEN', 'NORMAL']
 - split sizes: train=90158 val=10016 test=1000

[MODEL] Creating deit_small_distilled_patch16_224 (HEAD-ONLY Linear Probe, backbone frozen)
[MODEL] Linear probe mode: backbone frozen, trainable modules = ['head', 'head_dist']
[PARAMS] total=21,669,512 trainable=3,080 (0.0142%)
[IMB] Train class counts: [28285, 9819, 7000, 45054]
[IMB] Class-Balanced weights (mean~1): [0.7512, 1.1301, 1.404, 0.7147]
[IMB] Sampler disabled. min=7000 max=45054 ratio=6.44
[OCT2017] Epoch 001/100 | lr=1.00e-04 | train_loss=1.0075 train_acc=75.47% | val_loss=0.7763 val_acc=85.26% val_macroF1=71.29% | ep_time=55.3s peakVRAM=0.29GB
[ES] New best val_loss=0.776278 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 002/100 | lr=1.50e-04 | train_loss=0.8324 train_acc=83.66% | val_loss=0.7018 val_acc=88.09% val_macroF1=77.88% | ep_time=53.8s peakVRAM=0.29GB
[ES] New best val_loss=0.701752 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 003/100 | lr=2.00e-04 | train_loss=0.7901 train_acc=85.27% | val_loss=0.6868 val_acc=89.08% val_macroF1=81.11% | ep_time=53.5s peakVRAM=0.29GB
[ES] New best val_loss=0.686839 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 004/100 | lr=2.50e-04 | train_loss=0.7686 train_acc=86.23% | val_loss=0.6739 val_acc=89.81% val_macroF1=81.69% | ep_time=53.4s peakVRAM=0.29GB
[ES] New best val_loss=0.673859 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 005/100 | lr=3.00e-04 | train_loss=0.7593 train_acc=86.63% | val_loss=0.6745 val_acc=90.04% val_macroF1=83.10% | ep_time=53.0s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 006/100 | lr=3.50e-04 | train_loss=0.7506 train_acc=86.96% | val_loss=0.6654 val_acc=90.44% val_macroF1=83.43% | ep_time=53.0s peakVRAM=0.29GB
[ES] New best val_loss=0.665419 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 007/100 | lr=4.00e-04 | train_loss=0.7530 train_acc=86.77% | val_loss=0.6602 val_acc=90.65% val_macroF1=83.19% | ep_time=53.1s peakVRAM=0.29GB
[ES] New best val_loss=0.660171 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 008/100 | lr=4.50e-04 | train_loss=0.7447 train_acc=87.31% | val_loss=0.6580 val_acc=90.55% val_macroF1=81.65% | ep_time=53.3s peakVRAM=0.29GB
[ES] New best val_loss=0.657987 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 009/100 | lr=5.00e-04 | train_loss=0.7400 train_acc=87.41% | val_loss=0.6619 val_acc=90.38% val_macroF1=83.67% | ep_time=53.3s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 010/100 | lr=5.00e-04 | train_loss=0.7422 train_acc=87.37% | val_loss=0.6560 val_acc=91.06% val_macroF1=83.84% | ep_time=53.4s peakVRAM=0.29GB
[ES] New best val_loss=0.656037 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 011/100 | lr=5.00e-04 | train_loss=0.7477 train_acc=87.11% | val_loss=0.6581 val_acc=90.67% val_macroF1=83.89% | ep_time=53.4s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 012/100 | lr=4.99e-04 | train_loss=0.7422 train_acc=87.30% | val_loss=0.6526 val_acc=91.20% val_macroF1=84.20% | ep_time=53.3s peakVRAM=0.29GB
[ES] New best val_loss=0.652592 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 013/100 | lr=4.99e-04 | train_loss=0.7406 train_acc=87.31% | val_loss=0.6788 val_acc=89.91% val_macroF1=83.43% | ep_time=53.1s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 014/100 | lr=4.98e-04 | train_loss=0.7342 train_acc=87.71% | val_loss=0.6550 val_acc=90.87% val_macroF1=83.76% | ep_time=53.0s peakVRAM=0.29GB
[ES] No improve 2/10
[OCT2017] Epoch 015/100 | lr=4.96e-04 | train_loss=0.7375 train_acc=87.47% | val_loss=0.6518 val_acc=91.10% val_macroF1=83.80% | ep_time=52.9s peakVRAM=0.29GB
[ES] New best val_loss=0.651819 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 016/100 | lr=4.95e-04 | train_loss=0.7364 train_acc=87.60% | val_loss=0.6553 val_acc=90.77% val_macroF1=84.25% | ep_time=53.2s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 017/100 | lr=4.93e-04 | train_loss=0.7345 train_acc=87.70% | val_loss=0.6541 val_acc=90.88% val_macroF1=82.70% | ep_time=52.7s peakVRAM=0.29GB
[ES] No improve 2/10
[OCT2017] Epoch 018/100 | lr=4.90e-04 | train_loss=0.7309 train_acc=87.79% | val_loss=0.6567 val_acc=90.80% val_macroF1=83.38% | ep_time=52.7s peakVRAM=0.29GB
[ES] No improve 3/10
[OCT2017] Epoch 019/100 | lr=4.88e-04 | train_loss=0.7307 train_acc=87.73% | val_loss=0.6503 val_acc=91.00% val_macroF1=84.62% | ep_time=52.7s peakVRAM=0.29GB
[ES] New best val_loss=0.650337 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 020/100 | lr=4.85e-04 | train_loss=0.7310 train_acc=87.80% | val_loss=0.6475 val_acc=91.46% val_macroF1=84.81% | ep_time=52.8s peakVRAM=0.29GB
[ES] New best val_loss=0.647455 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 021/100 | lr=4.82e-04 | train_loss=0.7266 train_acc=88.01% | val_loss=0.6518 val_acc=90.83% val_macroF1=82.11% | ep_time=52.7s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 022/100 | lr=4.78e-04 | train_loss=0.7267 train_acc=87.97% | val_loss=0.6521 val_acc=91.31% val_macroF1=83.70% | ep_time=52.6s peakVRAM=0.29GB
[ES] No improve 2/10
[OCT2017] Epoch 023/100 | lr=4.75e-04 | train_loss=0.7270 train_acc=87.93% | val_loss=0.6465 val_acc=91.54% val_macroF1=84.68% | ep_time=52.6s peakVRAM=0.29GB
[ES] New best val_loss=0.646504 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 024/100 | lr=4.71e-04 | train_loss=0.7268 train_acc=88.02% | val_loss=0.6471 val_acc=91.39% val_macroF1=84.92% | ep_time=52.6s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 025/100 | lr=4.67e-04 | train_loss=0.7303 train_acc=87.88% | val_loss=0.6502 val_acc=91.09% val_macroF1=84.59% | ep_time=52.8s peakVRAM=0.29GB
[ES] No improve 2/10
[OCT2017] Epoch 026/100 | lr=4.62e-04 | train_loss=0.7234 train_acc=88.13% | val_loss=0.6526 val_acc=90.72% val_macroF1=84.21% | ep_time=52.7s peakVRAM=0.29GB
[ES] No improve 3/10
[OCT2017] Epoch 027/100 | lr=4.57e-04 | train_loss=0.7278 train_acc=87.88% | val_loss=0.6550 val_acc=90.84% val_macroF1=82.40% | ep_time=52.9s peakVRAM=0.29GB
[ES] No improve 4/10
[OCT2017] Epoch 028/100 | lr=4.52e-04 | train_loss=0.7277 train_acc=87.96% | val_loss=0.6502 val_acc=91.16% val_macroF1=84.57% | ep_time=52.7s peakVRAM=0.29GB
[ES] No improve 5/10
[OCT2017] Epoch 029/100 | lr=4.47e-04 | train_loss=0.7288 train_acc=87.82% | val_loss=0.6540 val_acc=90.95% val_macroF1=84.77% | ep_time=52.7s peakVRAM=0.29GB
[ES] No improve 6/10
[OCT2017] Epoch 030/100 | lr=4.42e-04 | train_loss=0.7256 train_acc=88.06% | val_loss=0.6469 val_acc=91.20% val_macroF1=84.36% | ep_time=52.5s peakVRAM=0.29GB
[ES] No improve 7/10
[OCT2017] Epoch 031/100 | lr=4.36e-04 | train_loss=0.7284 train_acc=87.88% | val_loss=0.6449 val_acc=91.13% val_macroF1=83.05% | ep_time=52.7s peakVRAM=0.29GB
[ES] New best val_loss=0.644865 -> saved runs\OCT2017\deit_small_linearprobe_4c\20251225-224812\best_model.pth
[OCT2017] Epoch 032/100 | lr=4.30e-04 | train_loss=0.7246 train_acc=88.19% | val_loss=0.6500 val_acc=90.95% val_macroF1=83.10% | ep_time=53.1s peakVRAM=0.29GB
[ES] No improve 1/10
[OCT2017] Epoch 033/100 | lr=4.24e-04 | train_loss=0.7252 train_acc=88.02% | val_loss=0.6473 val_acc=91.32% val_macroF1=84.17% | ep_time=54.4s peakVRAM=0.29GB
[ES] No improve 2/10
[OCT2017] Epoch 034/100 | lr=4.17e-04 | train_loss=0.7263 train_acc=87.96% | val_loss=0.6496 val_acc=91.29% val_macroF1=85.13% | ep_time=53.9s peakVRAM=0.29GB
[ES] No improve 3/10
[OCT2017] Epoch 035/100 | lr=4.11e-04 | train_loss=0.7244 train_acc=88.14% | val_loss=0.6510 val_acc=91.06% val_macroF1=84.93% | ep_time=53.4s peakVRAM=0.29GB
[ES] No improve 4/10
[OCT2017] Epoch 036/100 | lr=4.04e-04 | train_loss=0.7228 train_acc=88.15% | val_loss=0.6576 val_acc=90.22% val_macroF1=83.98% | ep_time=53.9s peakVRAM=0.29GB
[ES] No improve 5/10
[OCT2017] Epoch 037/100 | lr=3.97e-04 | train_loss=0.7244 train_acc=88.12% | val_loss=0.6488 val_acc=91.04% val_macroF1=83.46% | ep_time=54.7s peakVRAM=0.29GB
[ES] No improve 6/10
[OCT2017] Epoch 038/100 | lr=3.90e-04 | train_loss=0.7235 train_acc=88.27% | val_loss=0.6459 val_acc=91.28% val_macroF1=83.88% | ep_time=54.2s peakVRAM=0.29GB
[ES] No improve 7/10
[OCT2017] Epoch 039/100 | lr=3.82e-04 | train_loss=0.7206 train_acc=88.25% | val_loss=0.6570 val_acc=90.57% val_macroF1=84.22% | ep_time=53.3s peakVRAM=0.29GB
[ES] No improve 8/10
[OCT2017] Epoch 040/100 | lr=3.75e-04 | train_loss=0.7239 train_acc=88.09% | val_loss=0.6505 val_acc=91.20% val_macroF1=84.65% | ep_time=53.3s peakVRAM=0.29GB
[ES] No improve 9/10
[OCT2017] Epoch 041/100 | lr=3.67e-04 | train_loss=0.7195 train_acc=88.43% | val_loss=0.6463 val_acc=91.40% val_macroF1=85.08% | ep_time=53.6s peakVRAM=0.29GB
[ES] No improve 10/10
[OCT2017] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.5552

------------------------------------------------------------------------------------------
[OCT2017] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         CNV     0.4767    0.9840    0.6423       250
         DME     1.0000    0.3000    0.4615       250
      DRUSEN     0.9783    0.1800    0.3041       250
      NORMAL     0.6804    0.9880    0.8059       250

    accuracy                         0.6130      1000
   macro avg     0.7839    0.6130    0.5534      1000
weighted avg     0.7839    0.6130    0.5534      1000


==========================================================================================
[OCT2017] TEST summary (uncalibrated): Acc=61.30% MacroF1=55.34% ECE=0.1398 NLL=0.7952 Brier=0.4565
[OCT2017] Macro-AUC=0.9771
[OCT2017] TEMP-SCALED (T=0.555): ECE=0.2356 NLL=1.0104 Brier=0.5411
[OCT2017] Params trainable: 3,080 (0.0142%)
[OCT2017] Inference latency (B=1): 13.565 ms/img (73.7 imgs/s), peakVRAM=0.10GB
[OCT2017] Inference throughput (B=64): 2569.9 imgs/s, peakVRAM=0.29GB
[OCT2017] Outputs saved in: runs\OCT2017\deit_small_linearprobe_4c\20251225-224812
==========================================================================================

