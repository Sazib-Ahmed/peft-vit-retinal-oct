
=== DATASET RUN START: THOCT ===

[DATA] Split/Class counts:
class  AMD  DME  NOR  TOTAL
split                      
test    85   88   87    260
train  392  413  405   1210
val     84   89   87    260
[DATA] Train imbalance: min=392, max=413, ratio=1.05
[RAM] Caching split='train' images=1210 as uint8 tensors. Estimated RAM ~ 0.17 GB
[RAM] Cached 1210 images for split='train'
[RAM] Caching split='val' images=260 as uint8 tensors. Estimated RAM ~ 0.04 GB
[RAM] Cached 260 images for split='val'
[RAM] Caching split='test' images=260 as uint8 tensors. Estimated RAM ~ 0.04 GB
[RAM] Cached 260 images for split='test'
[IMB] Train class counts: [392, 413, 405]
[IMB] Class-Balanced weights (mean~1): [1.0279, 0.9766, 0.9955]
[IMB] Sampler disabled. min=392 max=413 ratio=1.05

[DATASET] THOCT
 - root: D:\AIUB\DSP\Code\Datasets\THOCT1800\THOCT1800_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (3): ['AMD', 'DME', 'NOR']
 - split sizes: train=1210 val=260 test=260

[MODEL] Creating deit_small_distilled_patch16_224 (HEAD-ONLY Linear Probe, backbone frozen)
[MODEL] Linear probe mode: backbone frozen, trainable modules = ['head', 'head_dist']
[PARAMS] total=21,668,742 trainable=2,310 (0.0107%)
[IMB] Train class counts: [392, 413, 405]
[IMB] Class-Balanced weights (mean~1): [1.0279, 0.9766, 0.9955]
[IMB] Sampler disabled. min=392 max=413 ratio=1.05
[THOCT] Epoch 001/100 | lr=1.00e-04 | train_loss=1.2092 train_acc=39.83% | val_loss=1.1614 val_acc=49.23% val_macroF1=41.41% | ep_time=1.4s peakVRAM=0.29GB
[ES] New best val_loss=1.161366 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 002/100 | lr=1.50e-04 | train_loss=1.1043 train_acc=40.08% | val_loss=1.0239 val_acc=46.54% val_macroF1=44.68% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=1.023930 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 003/100 | lr=2.00e-04 | train_loss=0.9768 train_acc=57.85% | val_loss=0.8784 val_acc=71.15% val_macroF1=71.07% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.878408 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 004/100 | lr=2.50e-04 | train_loss=0.8801 train_acc=69.34% | val_loss=0.7342 val_acc=81.54% val_macroF1=81.51% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.734180 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 005/100 | lr=3.00e-04 | train_loss=0.7383 train_acc=82.31% | val_loss=0.6240 val_acc=85.00% val_macroF1=84.98% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.624022 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 006/100 | lr=3.50e-04 | train_loss=0.6575 train_acc=82.23% | val_loss=0.5348 val_acc=91.54% val_macroF1=91.44% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.534838 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 007/100 | lr=4.00e-04 | train_loss=0.5611 train_acc=88.02% | val_loss=0.4923 val_acc=91.15% val_macroF1=91.04% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.492319 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 008/100 | lr=4.50e-04 | train_loss=0.5190 train_acc=90.50% | val_loss=0.4514 val_acc=93.46% val_macroF1=93.43% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.451424 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 009/100 | lr=5.00e-04 | train_loss=0.4991 train_acc=90.74% | val_loss=0.4321 val_acc=94.23% val_macroF1=94.19% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.432099 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 010/100 | lr=5.00e-04 | train_loss=0.5053 train_acc=89.26% | val_loss=0.4179 val_acc=95.77% val_macroF1=95.70% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.417939 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 011/100 | lr=5.00e-04 | train_loss=0.4996 train_acc=89.92% | val_loss=0.4076 val_acc=95.77% val_macroF1=95.74% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.407587 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 012/100 | lr=4.99e-04 | train_loss=0.4660 train_acc=93.22% | val_loss=0.3958 val_acc=97.69% val_macroF1=97.67% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.395773 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 013/100 | lr=4.99e-04 | train_loss=0.4334 train_acc=95.12% | val_loss=0.4064 val_acc=96.54% val_macroF1=96.51% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 014/100 | lr=4.98e-04 | train_loss=0.4978 train_acc=89.75% | val_loss=0.3878 val_acc=97.69% val_macroF1=97.68% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.387758 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 015/100 | lr=4.96e-04 | train_loss=0.4613 train_acc=92.31% | val_loss=0.3867 val_acc=97.69% val_macroF1=97.68% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.386698 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 016/100 | lr=4.95e-04 | train_loss=0.4127 train_acc=95.87% | val_loss=0.3858 val_acc=96.92% val_macroF1=96.92% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.385750 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 017/100 | lr=4.93e-04 | train_loss=0.4712 train_acc=91.74% | val_loss=0.3955 val_acc=97.31% val_macroF1=97.28% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 018/100 | lr=4.90e-04 | train_loss=0.4110 train_acc=96.53% | val_loss=0.3849 val_acc=96.92% val_macroF1=96.91% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.384947 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 019/100 | lr=4.88e-04 | train_loss=0.4593 train_acc=92.48% | val_loss=0.3949 val_acc=96.54% val_macroF1=96.53% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 020/100 | lr=4.85e-04 | train_loss=0.4333 train_acc=94.30% | val_loss=0.3869 val_acc=97.31% val_macroF1=97.30% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 021/100 | lr=4.82e-04 | train_loss=0.4630 train_acc=92.81% | val_loss=0.3951 val_acc=97.69% val_macroF1=97.67% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 3/10
[THOCT] Epoch 022/100 | lr=4.78e-04 | train_loss=0.4575 train_acc=92.07% | val_loss=0.3812 val_acc=97.69% val_macroF1=97.68% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.381192 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 023/100 | lr=4.75e-04 | train_loss=0.4202 train_acc=94.88% | val_loss=0.3795 val_acc=97.69% val_macroF1=97.68% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.379475 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 024/100 | lr=4.71e-04 | train_loss=0.4205 train_acc=94.55% | val_loss=0.3716 val_acc=98.08% val_macroF1=98.06% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.371626 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 025/100 | lr=4.67e-04 | train_loss=0.4336 train_acc=94.96% | val_loss=0.3789 val_acc=98.08% val_macroF1=98.06% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 026/100 | lr=4.62e-04 | train_loss=0.4116 train_acc=95.95% | val_loss=0.3690 val_acc=98.08% val_macroF1=98.07% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.368996 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 027/100 | lr=4.57e-04 | train_loss=0.4544 train_acc=94.05% | val_loss=0.3758 val_acc=98.08% val_macroF1=98.07% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 028/100 | lr=4.52e-04 | train_loss=0.4478 train_acc=93.31% | val_loss=0.3748 val_acc=98.46% val_macroF1=98.46% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 029/100 | lr=4.47e-04 | train_loss=0.4237 train_acc=95.12% | val_loss=0.3896 val_acc=97.31% val_macroF1=97.28% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 3/10
[THOCT] Epoch 030/100 | lr=4.42e-04 | train_loss=0.4170 train_acc=94.88% | val_loss=0.3675 val_acc=98.46% val_macroF1=98.46% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.367525 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 031/100 | lr=4.36e-04 | train_loss=0.3936 train_acc=96.61% | val_loss=0.3759 val_acc=98.08% val_macroF1=98.06% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 032/100 | lr=4.30e-04 | train_loss=0.4148 train_acc=95.37% | val_loss=0.3657 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.365701 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 033/100 | lr=4.24e-04 | train_loss=0.3893 train_acc=96.69% | val_loss=0.3823 val_acc=97.31% val_macroF1=97.28% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 034/100 | lr=4.17e-04 | train_loss=0.4377 train_acc=93.64% | val_loss=0.3649 val_acc=98.08% val_macroF1=98.07% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.364881 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 035/100 | lr=4.11e-04 | train_loss=0.4025 train_acc=96.69% | val_loss=0.3761 val_acc=97.31% val_macroF1=97.28% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 036/100 | lr=4.04e-04 | train_loss=0.4580 train_acc=91.57% | val_loss=0.3650 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 037/100 | lr=3.97e-04 | train_loss=0.4127 train_acc=94.71% | val_loss=0.3643 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.364301 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 038/100 | lr=3.90e-04 | train_loss=0.4161 train_acc=95.12% | val_loss=0.3667 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 039/100 | lr=3.82e-04 | train_loss=0.4010 train_acc=96.36% | val_loss=0.3669 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 040/100 | lr=3.75e-04 | train_loss=0.3955 train_acc=97.02% | val_loss=0.3698 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 3/10
[THOCT] Epoch 041/100 | lr=3.67e-04 | train_loss=0.4594 train_acc=92.15% | val_loss=0.3696 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 4/10
[THOCT] Epoch 042/100 | lr=3.60e-04 | train_loss=0.3828 train_acc=97.52% | val_loss=0.3589 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.358921 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 043/100 | lr=3.52e-04 | train_loss=0.4277 train_acc=94.38% | val_loss=0.3717 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 044/100 | lr=3.44e-04 | train_loss=0.4221 train_acc=95.04% | val_loss=0.3660 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 045/100 | lr=3.36e-04 | train_loss=0.4281 train_acc=95.12% | val_loss=0.3625 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 3/10
[THOCT] Epoch 046/100 | lr=3.27e-04 | train_loss=0.3861 train_acc=96.78% | val_loss=0.3655 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 4/10
[THOCT] Epoch 047/100 | lr=3.19e-04 | train_loss=0.4324 train_acc=94.21% | val_loss=0.3676 val_acc=98.46% val_macroF1=98.45% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 5/10
[THOCT] Epoch 048/100 | lr=3.10e-04 | train_loss=0.3783 train_acc=97.77% | val_loss=0.3598 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 6/10
[THOCT] Epoch 049/100 | lr=3.02e-04 | train_loss=0.4343 train_acc=94.63% | val_loss=0.3649 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 7/10
[THOCT] Epoch 050/100 | lr=2.93e-04 | train_loss=0.4071 train_acc=96.36% | val_loss=0.3552 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.355204 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 051/100 | lr=2.85e-04 | train_loss=0.3794 train_acc=97.93% | val_loss=0.3693 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 052/100 | lr=2.76e-04 | train_loss=0.3878 train_acc=97.02% | val_loss=0.3658 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 053/100 | lr=2.67e-04 | train_loss=0.4092 train_acc=96.03% | val_loss=0.3580 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 3/10
[THOCT] Epoch 054/100 | lr=2.59e-04 | train_loss=0.3954 train_acc=96.28% | val_loss=0.3601 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 4/10
[THOCT] Epoch 055/100 | lr=2.50e-04 | train_loss=0.4103 train_acc=95.04% | val_loss=0.3544 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] New best val_loss=0.354439 -> saved runs\THOCT\deit_small_linearprobe_3c\20251225-074129\best_model.pth
[THOCT] Epoch 056/100 | lr=2.41e-04 | train_loss=0.4434 train_acc=93.39% | val_loss=0.3656 val_acc=98.85% val_macroF1=98.85% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 1/10
[THOCT] Epoch 057/100 | lr=2.33e-04 | train_loss=0.4214 train_acc=95.37% | val_loss=0.3608 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 2/10
[THOCT] Epoch 058/100 | lr=2.24e-04 | train_loss=0.4480 train_acc=93.39% | val_loss=0.3600 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 3/10
[THOCT] Epoch 059/100 | lr=2.15e-04 | train_loss=0.3679 train_acc=98.26% | val_loss=0.3624 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 4/10
[THOCT] Epoch 060/100 | lr=2.07e-04 | train_loss=0.4130 train_acc=95.21% | val_loss=0.3591 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 5/10
[THOCT] Epoch 061/100 | lr=1.98e-04 | train_loss=0.4080 train_acc=95.87% | val_loss=0.3589 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 6/10
[THOCT] Epoch 062/100 | lr=1.90e-04 | train_loss=0.3919 train_acc=96.94% | val_loss=0.3613 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 7/10
[THOCT] Epoch 063/100 | lr=1.81e-04 | train_loss=0.3893 train_acc=97.11% | val_loss=0.3622 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 8/10
[THOCT] Epoch 064/100 | lr=1.73e-04 | train_loss=0.3882 train_acc=97.11% | val_loss=0.3617 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 9/10
[THOCT] Epoch 065/100 | lr=1.64e-04 | train_loss=0.3894 train_acc=96.28% | val_loss=0.3580 val_acc=99.23% val_macroF1=99.23% | ep_time=0.7s peakVRAM=0.29GB
[ES] No improve 10/10
[THOCT] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.3860

------------------------------------------------------------------------------------------
[THOCT] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         AMD     0.9643    0.9529    0.9586        85
         DME     0.9545    0.9545    0.9545        88
         NOR     0.9886    1.0000    0.9943        87

    accuracy                         0.9692       260
   macro avg     0.9692    0.9692    0.9691       260
weighted avg     0.9691    0.9692    0.9692       260


==========================================================================================
[THOCT] TEST summary (uncalibrated): Acc=96.92% MacroF1=96.91% ECE=0.0912 NLL=0.1309 Brier=0.0500
[THOCT] Macro-AUC=0.9988
[THOCT] TEMP-SCALED (T=0.386): ECE=0.0130 NLL=0.0583 Brier=0.0348
[THOCT] Params trainable: 2,310 (0.0107%)
[THOCT] Inference latency (B=1): 11.478 ms/img (87.1 imgs/s), peakVRAM=0.10GB
[THOCT] Inference throughput (B=64): 2570.7 imgs/s, peakVRAM=0.29GB
[THOCT] Outputs saved in: runs\THOCT\deit_small_linearprobe_3c\20251225-074129
==========================================================================================

