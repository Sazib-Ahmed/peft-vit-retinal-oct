
=== DATASET RUN START: NEH_UT_2021 ===

[DATA] Split/Class counts:
class   CNV  DRUSEN  NORMAL  TOTAL
split                             
test    544     687    1292   2523
train  2188    3525    5791  11504
val     471     690    1475   2636
[DATA] Train imbalance: min=2188, max=5791, ratio=2.65
[RAM] Caching split='train' images=11504 as uint8 tensors. Estimated RAM ~ 1.61 GB
[RAM] Cached 11504 images for split='train'
[RAM] Caching split='val' images=2636 as uint8 tensors. Estimated RAM ~ 0.37 GB
[RAM] Cached 2636 images for split='val'
[RAM] Caching split='test' images=2523 as uint8 tensors. Estimated RAM ~ 0.35 GB
[RAM] Cached 2523 images for split='test'
[IMB] Train class counts: [2188, 3525, 5791]
[IMB] Class-Balanced weights (mean~1): [1.4228, 0.9412, 0.636]
[IMB] Sampler disabled. min=2188 max=5791 ratio=2.65

[DATASET] NEH_UT_2021
 - root: D:\AIUB\DSP\Code\Datasets\NEH_UT_2021RetinalOCTDataset\NEH_UT_2021RetinalOCTDataset_V2_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (3): ['CNV', 'DRUSEN', 'NORMAL']
 - split sizes: train=11504 val=2636 test=2523

[MODEL] Creating deit_small_distilled_patch16_224 (HEAD-ONLY Linear Probe, backbone frozen)
[MODEL] Linear probe mode: backbone frozen, trainable modules = ['head', 'head_dist']
[PARAMS] total=21,668,742 trainable=2,310 (0.0107%)
[IMB] Train class counts: [2188, 3525, 5791]
[IMB] Class-Balanced weights (mean~1): [1.4228, 0.9412, 0.636]
[IMB] Sampler disabled. min=2188 max=5791 ratio=2.65
[NEH_UT_2021] Epoch 001/100 | lr=1.00e-04 | train_loss=1.0342 train_acc=50.45% | val_loss=0.9210 val_acc=66.16% val_macroF1=57.07% | ep_time=7.1s peakVRAM=0.29GB
[ES] New best val_loss=0.921039 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 002/100 | lr=1.50e-04 | train_loss=0.9103 train_acc=61.76% | val_loss=0.8199 val_acc=73.29% val_macroF1=68.33% | ep_time=6.9s peakVRAM=0.29GB
[ES] New best val_loss=0.819945 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 003/100 | lr=2.00e-04 | train_loss=0.8574 train_acc=65.54% | val_loss=0.7767 val_acc=76.40% val_macroF1=73.72% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.776673 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 004/100 | lr=2.50e-04 | train_loss=0.8266 train_acc=68.05% | val_loss=0.7492 val_acc=78.68% val_macroF1=76.08% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.749178 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 005/100 | lr=3.00e-04 | train_loss=0.8003 train_acc=70.50% | val_loss=0.7376 val_acc=79.51% val_macroF1=77.53% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.737566 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 006/100 | lr=3.50e-04 | train_loss=0.7922 train_acc=71.08% | val_loss=0.7451 val_acc=78.34% val_macroF1=77.43% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 007/100 | lr=4.00e-04 | train_loss=0.7856 train_acc=71.75% | val_loss=0.7429 val_acc=79.78% val_macroF1=75.11% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 008/100 | lr=4.50e-04 | train_loss=0.7638 train_acc=72.71% | val_loss=0.7278 val_acc=81.07% val_macroF1=78.64% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.727807 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 009/100 | lr=5.00e-04 | train_loss=0.7617 train_acc=72.88% | val_loss=0.7210 val_acc=79.21% val_macroF1=78.17% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.721017 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 010/100 | lr=5.00e-04 | train_loss=0.7704 train_acc=72.31% | val_loss=0.7334 val_acc=80.69% val_macroF1=77.28% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 011/100 | lr=5.00e-04 | train_loss=0.7594 train_acc=73.06% | val_loss=0.7191 val_acc=79.32% val_macroF1=78.52% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.719132 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 012/100 | lr=4.99e-04 | train_loss=0.7645 train_acc=72.37% | val_loss=0.7196 val_acc=81.15% val_macroF1=78.44% | ep_time=6.9s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 013/100 | lr=4.99e-04 | train_loss=0.7468 train_acc=74.07% | val_loss=0.7155 val_acc=80.77% val_macroF1=78.53% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.715497 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 014/100 | lr=4.98e-04 | train_loss=0.7578 train_acc=73.11% | val_loss=0.7350 val_acc=78.22% val_macroF1=77.77% | ep_time=7.1s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 015/100 | lr=4.96e-04 | train_loss=0.7488 train_acc=73.72% | val_loss=0.7309 val_acc=78.91% val_macroF1=78.42% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 016/100 | lr=4.95e-04 | train_loss=0.7435 train_acc=74.13% | val_loss=0.7468 val_acc=76.90% val_macroF1=76.99% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 3/10
[NEH_UT_2021] Epoch 017/100 | lr=4.93e-04 | train_loss=0.7465 train_acc=74.02% | val_loss=0.7545 val_acc=74.96% val_macroF1=76.21% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 4/10
[NEH_UT_2021] Epoch 018/100 | lr=4.90e-04 | train_loss=0.7474 train_acc=73.77% | val_loss=0.7253 val_acc=78.41% val_macroF1=78.31% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 5/10
[NEH_UT_2021] Epoch 019/100 | lr=4.88e-04 | train_loss=0.7355 train_acc=74.75% | val_loss=0.7390 val_acc=76.86% val_macroF1=77.63% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 6/10
[NEH_UT_2021] Epoch 020/100 | lr=4.85e-04 | train_loss=0.7467 train_acc=74.17% | val_loss=0.7154 val_acc=79.67% val_macroF1=78.83% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.715435 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 021/100 | lr=4.82e-04 | train_loss=0.7383 train_acc=75.08% | val_loss=0.7193 val_acc=81.64% val_macroF1=79.01% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 022/100 | lr=4.78e-04 | train_loss=0.7471 train_acc=74.17% | val_loss=0.7287 val_acc=79.02% val_macroF1=78.68% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 023/100 | lr=4.75e-04 | train_loss=0.7513 train_acc=73.14% | val_loss=0.7187 val_acc=79.36% val_macroF1=78.65% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 3/10
[NEH_UT_2021] Epoch 024/100 | lr=4.71e-04 | train_loss=0.7462 train_acc=73.95% | val_loss=0.7276 val_acc=78.68% val_macroF1=78.61% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 4/10
[NEH_UT_2021] Epoch 025/100 | lr=4.67e-04 | train_loss=0.7395 train_acc=74.46% | val_loss=0.7126 val_acc=80.16% val_macroF1=79.29% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.712555 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 026/100 | lr=4.62e-04 | train_loss=0.7366 train_acc=74.30% | val_loss=0.7081 val_acc=80.58% val_macroF1=79.27% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.708109 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 027/100 | lr=4.57e-04 | train_loss=0.7341 train_acc=74.91% | val_loss=0.7183 val_acc=80.27% val_macroF1=79.04% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 028/100 | lr=4.52e-04 | train_loss=0.7348 train_acc=74.89% | val_loss=0.7173 val_acc=80.01% val_macroF1=78.86% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 029/100 | lr=4.47e-04 | train_loss=0.7306 train_acc=75.07% | val_loss=0.7275 val_acc=79.21% val_macroF1=79.03% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 3/10
[NEH_UT_2021] Epoch 030/100 | lr=4.42e-04 | train_loss=0.7424 train_acc=74.23% | val_loss=0.7083 val_acc=81.30% val_macroF1=79.52% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 4/10
[NEH_UT_2021] Epoch 031/100 | lr=4.36e-04 | train_loss=0.7371 train_acc=74.77% | val_loss=0.7235 val_acc=80.08% val_macroF1=79.09% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 5/10
[NEH_UT_2021] Epoch 032/100 | lr=4.30e-04 | train_loss=0.7367 train_acc=74.37% | val_loss=0.7283 val_acc=80.80% val_macroF1=78.85% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 6/10
[NEH_UT_2021] Epoch 033/100 | lr=4.24e-04 | train_loss=0.7457 train_acc=74.04% | val_loss=0.7109 val_acc=80.42% val_macroF1=78.55% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 7/10
[NEH_UT_2021] Epoch 034/100 | lr=4.17e-04 | train_loss=0.7307 train_acc=75.05% | val_loss=0.7236 val_acc=78.11% val_macroF1=78.42% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 8/10
[NEH_UT_2021] Epoch 035/100 | lr=4.11e-04 | train_loss=0.7252 train_acc=75.37% | val_loss=0.7087 val_acc=80.39% val_macroF1=79.71% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 9/10
[NEH_UT_2021] Epoch 036/100 | lr=4.04e-04 | train_loss=0.7325 train_acc=74.48% | val_loss=0.7059 val_acc=81.03% val_macroF1=79.92% | ep_time=7.0s peakVRAM=0.29GB
[ES] New best val_loss=0.705862 -> saved runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708\best_model.pth
[NEH_UT_2021] Epoch 037/100 | lr=3.97e-04 | train_loss=0.7315 train_acc=75.17% | val_loss=0.7064 val_acc=81.11% val_macroF1=79.35% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 038/100 | lr=3.90e-04 | train_loss=0.7298 train_acc=74.97% | val_loss=0.7127 val_acc=80.01% val_macroF1=78.78% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 039/100 | lr=3.82e-04 | train_loss=0.7369 train_acc=74.85% | val_loss=0.7163 val_acc=79.63% val_macroF1=78.93% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 3/10
[NEH_UT_2021] Epoch 040/100 | lr=3.75e-04 | train_loss=0.7314 train_acc=75.05% | val_loss=0.7082 val_acc=80.88% val_macroF1=79.19% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 4/10
[NEH_UT_2021] Epoch 041/100 | lr=3.67e-04 | train_loss=0.7406 train_acc=74.08% | val_loss=0.7144 val_acc=80.50% val_macroF1=78.65% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 5/10
[NEH_UT_2021] Epoch 042/100 | lr=3.60e-04 | train_loss=0.7316 train_acc=74.75% | val_loss=0.7093 val_acc=80.58% val_macroF1=79.20% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 6/10
[NEH_UT_2021] Epoch 043/100 | lr=3.52e-04 | train_loss=0.7280 train_acc=74.85% | val_loss=0.7061 val_acc=81.30% val_macroF1=78.76% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 7/10
[NEH_UT_2021] Epoch 044/100 | lr=3.44e-04 | train_loss=0.7256 train_acc=75.46% | val_loss=0.7141 val_acc=80.84% val_macroF1=79.23% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 8/10
[NEH_UT_2021] Epoch 045/100 | lr=3.36e-04 | train_loss=0.7308 train_acc=74.77% | val_loss=0.7098 val_acc=80.92% val_macroF1=78.80% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 9/10
[NEH_UT_2021] Epoch 046/100 | lr=3.27e-04 | train_loss=0.7381 train_acc=74.13% | val_loss=0.7105 val_acc=80.42% val_macroF1=79.40% | ep_time=7.0s peakVRAM=0.29GB
[ES] No improve 10/10
[NEH_UT_2021] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.6104

------------------------------------------------------------------------------------------
[NEH_UT_2021] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         CNV     0.7926    0.8290    0.8104       544
      DRUSEN     0.6890    0.5997    0.6412       687
      NORMAL     0.8363    0.8777    0.8565      1292

    accuracy                         0.7915      2523
   macro avg     0.7726    0.7688    0.7694      2523
weighted avg     0.7868    0.7915    0.7879      2523


==========================================================================================
[NEH_UT_2021] TEST summary (uncalibrated): Acc=79.15% MacroF1=76.94% ECE=0.0899 NLL=0.5549 Brier=0.3157
[NEH_UT_2021] Macro-AUC=0.9077
[NEH_UT_2021] TEMP-SCALED (T=0.610): ECE=0.0211 NLL=0.5277 Brier=0.3002
[NEH_UT_2021] Params trainable: 2,310 (0.0107%)
[NEH_UT_2021] Inference latency (B=1): 11.736 ms/img (85.2 imgs/s), peakVRAM=0.10GB
[NEH_UT_2021] Inference throughput (B=64): 2561.9 imgs/s, peakVRAM=0.29GB
[NEH_UT_2021] Outputs saved in: runs\NEH_UT_2021\deit_small_linearprobe_3c\20251225-074708
==========================================================================================

