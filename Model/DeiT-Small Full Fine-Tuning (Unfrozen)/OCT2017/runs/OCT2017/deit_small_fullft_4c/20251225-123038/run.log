
=== DATASET RUN START: OCT2017 ===

[DATA] Split/Class counts:
class    CNV   DME  DRUSEN  NORMAL  TOTAL
split                                    
test     250   250     250     250   1000
train  28285  9819    7000   45054  90158
val     3142  1091     777    5006  10016
[DATA] Train imbalance: min=7000, max=45054, ratio=6.44
[RAM] Caching split='train' images=90158 as uint8 tensors. Estimated RAM ~ 12.64 GB
[RAM] Cached 90158 images for split='train'
[RAM] Caching split='val' images=10016 as uint8 tensors. Estimated RAM ~ 1.40 GB
[RAM] Cached 10016 images for split='val'
[RAM] Caching split='test' images=1000 as uint8 tensors. Estimated RAM ~ 0.14 GB
[RAM] Cached 1000 images for split='test'
[IMB] Train class counts: [28285, 9819, 7000, 45054]
[IMB] Class-Balanced weights (mean~1): [0.7512, 1.1301, 1.404, 0.7147]
[IMB] Sampler disabled. min=7000 max=45054 ratio=6.44

[DATASET] OCT2017
 - root: D:\AIUB\DSP\Code\Datasets\ZhangLabData\OCT2017_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (4): ['CNV', 'DME', 'DRUSEN', 'NORMAL']
 - split sizes: train=90158 val=10016 test=1000

[MODEL] Creating deit_small_distilled_patch16_224 (FULL fine-tuning, all params trainable)
[PARAMS] total=21,669,512 trainable=21,669,512 (100.00%)
[IMB] Train class counts: [28285, 9819, 7000, 45054]
[IMB] Class-Balanced weights (mean~1): [0.7512, 1.1301, 1.404, 0.7147]
[IMB] Sampler disabled. min=7000 max=45054 ratio=6.44
[OCT2017] Epoch 001/100 | lr=1.00e-04 | train_loss=0.6222 train_acc=91.39% | val_loss=0.5316 val_acc=95.70% val_macroF1=92.65% | ep_time=148.1s peakVRAM=2.45GB
[ES] New best val_loss=0.531576 -> saved runs\OCT2017\deit_small_fullft_4c\20251225-123038\best_model.pth
[OCT2017] Epoch 002/100 | lr=1.50e-04 | train_loss=0.5995 train_acc=92.24% | val_loss=0.5540 val_acc=94.44% val_macroF1=90.79% | ep_time=144.7s peakVRAM=2.45GB
[ES] No improve 1/10
[OCT2017] Epoch 003/100 | lr=2.00e-04 | train_loss=0.6099 train_acc=91.74% | val_loss=0.5280 val_acc=95.15% val_macroF1=91.67% | ep_time=144.6s peakVRAM=2.45GB
[ES] New best val_loss=0.527961 -> saved runs\OCT2017\deit_small_fullft_4c\20251225-123038\best_model.pth
[OCT2017] Epoch 004/100 | lr=2.50e-04 | train_loss=0.6190 train_acc=91.30% | val_loss=0.5320 val_acc=95.22% val_macroF1=90.99% | ep_time=144.5s peakVRAM=2.45GB
[ES] No improve 1/10
[OCT2017] Epoch 005/100 | lr=3.00e-04 | train_loss=0.6279 train_acc=90.91% | val_loss=0.5291 val_acc=95.47% val_macroF1=92.04% | ep_time=144.5s peakVRAM=2.45GB
[ES] No improve 2/10
[OCT2017] Epoch 006/100 | lr=3.50e-04 | train_loss=0.6364 train_acc=90.53% | val_loss=0.5555 val_acc=94.08% val_macroF1=90.32% | ep_time=144.2s peakVRAM=2.45GB
[ES] No improve 3/10
[OCT2017] Epoch 007/100 | lr=4.00e-04 | train_loss=0.6507 train_acc=89.84% | val_loss=0.5591 val_acc=93.71% val_macroF1=89.46% | ep_time=144.3s peakVRAM=2.45GB
[ES] No improve 4/10
[OCT2017] Epoch 008/100 | lr=4.50e-04 | train_loss=0.6508 train_acc=89.76% | val_loss=0.5334 val_acc=95.25% val_macroF1=91.39% | ep_time=144.3s peakVRAM=2.45GB
[ES] No improve 5/10
[OCT2017] Epoch 009/100 | lr=5.00e-04 | train_loss=0.6630 train_acc=89.12% | val_loss=0.5667 val_acc=93.60% val_macroF1=89.49% | ep_time=144.4s peakVRAM=2.45GB
[ES] No improve 6/10
[OCT2017] Epoch 010/100 | lr=5.00e-04 | train_loss=0.6697 train_acc=88.87% | val_loss=0.5487 val_acc=94.31% val_macroF1=89.62% | ep_time=144.4s peakVRAM=2.45GB
[ES] No improve 7/10
[OCT2017] Epoch 011/100 | lr=5.00e-04 | train_loss=0.6594 train_acc=89.38% | val_loss=0.5430 val_acc=94.71% val_macroF1=90.43% | ep_time=144.5s peakVRAM=2.45GB
[ES] No improve 8/10
[OCT2017] Epoch 012/100 | lr=4.99e-04 | train_loss=0.6487 train_acc=89.79% | val_loss=0.5382 val_acc=94.70% val_macroF1=90.53% | ep_time=144.6s peakVRAM=2.45GB
[ES] No improve 9/10
[OCT2017] Epoch 013/100 | lr=4.99e-04 | train_loss=0.6455 train_acc=89.98% | val_loss=0.5507 val_acc=94.40% val_macroF1=90.59% | ep_time=144.5s peakVRAM=2.45GB
[ES] No improve 10/10
[OCT2017] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.6168

------------------------------------------------------------------------------------------
[OCT2017] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         CNV     0.8245    0.9960    0.9022       250
         DME     0.9957    0.9160    0.9542       250
      DRUSEN     0.9495    0.8280    0.8846       250
      NORMAL     0.9680    0.9680    0.9680       250

    accuracy                         0.9270      1000
   macro avg     0.9344    0.9270    0.9272      1000
weighted avg     0.9344    0.9270    0.9272      1000


==========================================================================================
[OCT2017] TEST summary (uncalibrated): Acc=92.70% MacroF1=92.72% ECE=0.0918 NLL=0.2756 Brier=0.1229
[OCT2017] Macro-AUC=0.9954
[OCT2017] TEMP-SCALED (T=0.617): ECE=0.0199 NLL=0.2166 Brier=0.1148
[OCT2017] Params trainable: 21,669,512 (100.00%)
[OCT2017] Inference latency (B=1): 11.982 ms/img (83.5 imgs/s), peakVRAM=0.23GB
[OCT2017] Inference throughput (B=64): 2569.3 imgs/s, peakVRAM=0.42GB
[OCT2017] Outputs saved in: runs\OCT2017\deit_small_fullft_4c\20251225-123038
==========================================================================================

