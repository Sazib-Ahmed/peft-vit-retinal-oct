
=== DATASET RUN START: C8 ===

[DATA] Split/Class counts:
class   AMD   CNV   CSR   DME    DR  DRUSEN    MH  NORMAL  TOTAL
split                                                           
test    350   350   350   349   350     349   350     349   2797
train  2300  2257  2300  2272  2300    2233  2300    2298  18260
val     350   347   350   349   350     348   350     349   2793
[DATA] Train imbalance: min=2233, max=2300, ratio=1.03
[RAM] Caching split='train' images=18260 as uint8 tensors. Estimated RAM ~ 2.56 GB
[RAM] Cached 18260 images for split='train'
[RAM] Caching split='val' images=2793 as uint8 tensors. Estimated RAM ~ 0.39 GB
[RAM] Cached 2793 images for split='val'
[RAM] Caching split='test' images=2797 as uint8 tensors. Estimated RAM ~ 0.39 GB
[RAM] Cached 2797 images for split='test'
[IMB] Train class counts: [2300, 2257, 2300, 2272, 2300, 2233, 2300, 2298]
[IMB] Class-Balanced weights (mean~1): [0.9931, 1.01, 0.9931, 1.004, 0.9931, 1.0196, 0.9931, 0.9939]
[IMB] Sampler disabled. min=2233 max=2300 ratio=1.03

[DATASET] C8
 - root: D:\AIUB\DSP\Code\Datasets\C8\RetinalOCT_Dataset_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (8): ['AMD', 'CNV', 'CSR', 'DME', 'DR', 'DRUSEN', 'MH', 'NORMAL']
 - split sizes: train=18260 val=2793 test=2797

[MODEL] Creating deit_small_distilled_patch16_224 (FULL fine-tuning, all params trainable)
[PARAMS] total=21,672,592 trainable=21,672,592 (100.00%)
[IMB] Train class counts: [2300, 2257, 2300, 2272, 2300, 2233, 2300, 2298]
[IMB] Class-Balanced weights (mean~1): [0.9931, 1.01, 0.9931, 1.004, 0.9931, 1.0196, 0.9931, 0.9939]
[IMB] Sampler disabled. min=2233 max=2300 ratio=1.03
[C8] Epoch 001/100 | lr=1.00e-04 | train_loss=0.8113 train_acc=84.38% | val_loss=0.5784 val_acc=94.70% val_macroF1=94.67% | ep_time=29.3s peakVRAM=2.45GB
[ES] New best val_loss=0.578365 -> saved runs\C8\deit_small_fullft_8c\20251224-223916\best_model.pth
[C8] Epoch 002/100 | lr=1.50e-04 | train_loss=0.7042 train_acc=89.37% | val_loss=0.5893 val_acc=94.52% val_macroF1=94.56% | ep_time=29.1s peakVRAM=2.45GB
[ES] No improve 1/10
[C8] Epoch 003/100 | lr=2.00e-04 | train_loss=0.7340 train_acc=87.59% | val_loss=0.5956 val_acc=93.70% val_macroF1=93.60% | ep_time=29.4s peakVRAM=2.45GB
[ES] No improve 2/10
[C8] Epoch 004/100 | lr=2.50e-04 | train_loss=0.7185 train_acc=88.49% | val_loss=0.5898 val_acc=94.67% val_macroF1=94.63% | ep_time=29.5s peakVRAM=2.45GB
[ES] No improve 3/10
[C8] Epoch 005/100 | lr=3.00e-04 | train_loss=0.7535 train_acc=86.48% | val_loss=0.6134 val_acc=93.09% val_macroF1=93.04% | ep_time=29.5s peakVRAM=2.45GB
[ES] No improve 4/10
[C8] Epoch 006/100 | lr=3.50e-04 | train_loss=0.7587 train_acc=86.48% | val_loss=0.6431 val_acc=91.62% val_macroF1=91.64% | ep_time=29.7s peakVRAM=2.45GB
[ES] No improve 5/10
[C8] Epoch 007/100 | lr=4.00e-04 | train_loss=0.7854 train_acc=84.90% | val_loss=0.6506 val_acc=91.91% val_macroF1=91.98% | ep_time=29.8s peakVRAM=2.45GB
[ES] No improve 6/10
[C8] Epoch 008/100 | lr=4.50e-04 | train_loss=0.8304 train_acc=82.95% | val_loss=0.6163 val_acc=92.73% val_macroF1=92.72% | ep_time=29.6s peakVRAM=2.45GB
[ES] No improve 7/10
[C8] Epoch 009/100 | lr=5.00e-04 | train_loss=0.7822 train_acc=85.16% | val_loss=0.7102 val_acc=89.04% val_macroF1=89.05% | ep_time=29.2s peakVRAM=2.45GB
[ES] No improve 8/10
[C8] Epoch 010/100 | lr=5.00e-04 | train_loss=0.8290 train_acc=82.97% | val_loss=0.6755 val_acc=90.30% val_macroF1=90.31% | ep_time=29.1s peakVRAM=2.45GB
[ES] No improve 9/10
[C8] Epoch 011/100 | lr=5.00e-04 | train_loss=0.8004 train_acc=84.31% | val_loss=0.6496 val_acc=92.16% val_macroF1=92.15% | ep_time=29.2s peakVRAM=2.45GB
[ES] No improve 10/10
[C8] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.6351

------------------------------------------------------------------------------------------
[C8] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         AMD     1.0000    1.0000    1.0000       350
         CNV     0.8956    0.9314    0.9132       350
         CSR     1.0000    0.9971    0.9986       350
         DME     0.9843    0.8997    0.9401       349
          DR     0.9943    1.0000    0.9972       350
      DRUSEN     0.8808    0.8682    0.8745       349
          MH     1.0000    0.9971    0.9986       350
      NORMAL     0.9000    0.9542    0.9263       349

    accuracy                         0.9560      2797
   macro avg     0.9569    0.9560    0.9560      2797
weighted avg     0.9569    0.9560    0.9561      2797


==========================================================================================
[C8] TEST summary (uncalibrated): Acc=95.60% MacroF1=95.60% ECE=0.0914 NLL=0.2141 Brier=0.0781
[C8] Macro-AUC=0.9969
[C8] TEMP-SCALED (T=0.635): ECE=0.0069 NLL=0.1413 Brier=0.0690
[C8] Params trainable: 21,672,592 (100.00%)
[C8] Inference latency (B=1): 11.670 ms/img (85.7 imgs/s), peakVRAM=0.24GB
[C8] Inference throughput (B=64): 2574.2 imgs/s, peakVRAM=0.42GB
[C8] Outputs saved in: runs\C8\deit_small_fullft_8c\20251224-223916
==========================================================================================

