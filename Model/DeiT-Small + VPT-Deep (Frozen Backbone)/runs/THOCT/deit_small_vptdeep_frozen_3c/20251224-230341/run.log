
=== DATASET RUN START: THOCT ===

[DATA] Split/Class counts:
class  AMD  DME  NOR  TOTAL
split                      
test    85   88   87    260
train  392  413  405   1210
val     84   89   87    260
[DATA] Train imbalance: min=392, max=413, ratio=1.05
[RAM] Caching split='train' images=1210 as uint8 tensors. Estimated RAM ~ 0.17 GB
[RAM] Cached 1210 images for split='train'
[RAM] Caching split='val' images=260 as uint8 tensors. Estimated RAM ~ 0.04 GB
[RAM] Cached 260 images for split='val'
[RAM] Caching split='test' images=260 as uint8 tensors. Estimated RAM ~ 0.04 GB
[RAM] Cached 260 images for split='test'
[IMB] Train class counts: [392, 413, 405]
[IMB] Class-Balanced weights (mean~1): [1.0279, 0.9766, 0.9955]
[IMB] Sampler disabled. min=392 max=413 ratio=1.05

[DATASET] THOCT
 - root: D:\AIUB\DSP\Code\Datasets\THOCT1800\THOCT1800_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (3): ['AMD', 'DME', 'NOR']
 - split sizes: train=1210 val=260 test=260

[MODEL] Creating deit_small_distilled_patch16_224 + VPT-Deep (frozen=True)
[PARAMS] total=21,760,902 trainable=94,470 (0.4341%)
[IMB] Train class counts: [392, 413, 405]
[IMB] Class-Balanced weights (mean~1): [1.0279, 0.9766, 0.9955]
[IMB] Sampler disabled. min=392 max=413 ratio=1.05
[THOCT] Epoch 001/100 | lr=1.00e-04 | train_loss=1.1385 train_acc=34.21% | val_loss=1.0969 val_acc=36.92% val_macroF1=27.18% | ep_time=2.7s peakVRAM=1.73GB
[ES] New best val_loss=1.096878 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 002/100 | lr=1.50e-04 | train_loss=1.0779 train_acc=39.50% | val_loss=1.0505 val_acc=40.00% val_macroF1=29.48% | ep_time=2.0s peakVRAM=1.74GB
[ES] New best val_loss=1.050463 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 003/100 | lr=2.00e-04 | train_loss=1.0197 train_acc=52.64% | val_loss=0.9320 val_acc=71.54% val_macroF1=69.74% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.932037 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 004/100 | lr=2.50e-04 | train_loss=0.9025 train_acc=63.06% | val_loss=0.6899 val_acc=83.08% val_macroF1=82.75% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.689867 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 005/100 | lr=3.00e-04 | train_loss=0.6729 train_acc=79.17% | val_loss=0.4982 val_acc=89.62% val_macroF1=89.50% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.498236 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 006/100 | lr=3.50e-04 | train_loss=0.5930 train_acc=86.12% | val_loss=0.4165 val_acc=95.00% val_macroF1=95.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.416503 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 007/100 | lr=4.00e-04 | train_loss=0.5371 train_acc=87.69% | val_loss=0.3571 val_acc=98.08% val_macroF1=98.09% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.357084 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 008/100 | lr=4.50e-04 | train_loss=0.5433 train_acc=87.19% | val_loss=0.5095 val_acc=87.69% val_macroF1=87.15% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 1/10
[THOCT] Epoch 009/100 | lr=5.00e-04 | train_loss=0.5392 train_acc=86.53% | val_loss=0.3496 val_acc=97.31% val_macroF1=97.32% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.349605 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 010/100 | lr=5.00e-04 | train_loss=0.4838 train_acc=90.74% | val_loss=0.3421 val_acc=98.08% val_macroF1=98.09% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.342135 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 011/100 | lr=5.00e-04 | train_loss=0.4085 train_acc=94.79% | val_loss=0.3405 val_acc=98.46% val_macroF1=98.46% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.340492 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 012/100 | lr=4.99e-04 | train_loss=0.4053 train_acc=94.71% | val_loss=0.3321 val_acc=98.85% val_macroF1=98.85% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.332102 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 013/100 | lr=4.99e-04 | train_loss=0.4427 train_acc=92.48% | val_loss=0.3292 val_acc=98.85% val_macroF1=98.85% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.329224 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 014/100 | lr=4.98e-04 | train_loss=0.4128 train_acc=94.38% | val_loss=0.3119 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.311917 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 015/100 | lr=4.96e-04 | train_loss=0.3614 train_acc=96.94% | val_loss=0.3311 val_acc=99.23% val_macroF1=99.23% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 1/10
[THOCT] Epoch 016/100 | lr=4.95e-04 | train_loss=0.3673 train_acc=96.53% | val_loss=0.3106 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.310644 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 017/100 | lr=4.93e-04 | train_loss=0.3460 train_acc=98.18% | val_loss=0.3052 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.305155 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 018/100 | lr=4.90e-04 | train_loss=0.3732 train_acc=95.62% | val_loss=0.3093 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 1/10
[THOCT] Epoch 019/100 | lr=4.88e-04 | train_loss=0.3307 train_acc=99.17% | val_loss=0.3081 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 2/10
[THOCT] Epoch 020/100 | lr=4.85e-04 | train_loss=0.3386 train_acc=98.02% | val_loss=0.3024 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.302407 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 021/100 | lr=4.82e-04 | train_loss=0.3287 train_acc=98.43% | val_loss=0.3055 val_acc=99.62% val_macroF1=99.61% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 1/10
[THOCT] Epoch 022/100 | lr=4.78e-04 | train_loss=0.3582 train_acc=96.69% | val_loss=0.3136 val_acc=99.23% val_macroF1=99.24% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 2/10
[THOCT] Epoch 023/100 | lr=4.75e-04 | train_loss=0.3940 train_acc=94.79% | val_loss=0.3117 val_acc=98.85% val_macroF1=98.85% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 3/10
[THOCT] Epoch 024/100 | lr=4.71e-04 | train_loss=0.3721 train_acc=95.95% | val_loss=0.3067 val_acc=99.62% val_macroF1=99.61% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 4/10
[THOCT] Epoch 025/100 | lr=4.67e-04 | train_loss=0.3697 train_acc=95.62% | val_loss=0.3257 val_acc=99.23% val_macroF1=99.24% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 5/10
[THOCT] Epoch 026/100 | lr=4.62e-04 | train_loss=0.3315 train_acc=98.26% | val_loss=0.3199 val_acc=98.85% val_macroF1=98.86% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 6/10
[THOCT] Epoch 027/100 | lr=4.57e-04 | train_loss=0.3109 train_acc=99.34% | val_loss=0.3088 val_acc=99.23% val_macroF1=99.24% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 7/10
[THOCT] Epoch 028/100 | lr=4.52e-04 | train_loss=0.3341 train_acc=97.77% | val_loss=0.3026 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 8/10
[THOCT] Epoch 029/100 | lr=4.47e-04 | train_loss=0.3365 train_acc=97.93% | val_loss=0.3058 val_acc=99.23% val_macroF1=99.24% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 9/10
[THOCT] Epoch 030/100 | lr=4.42e-04 | train_loss=0.3225 train_acc=98.93% | val_loss=0.2988 val_acc=99.62% val_macroF1=99.61% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.298821 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 031/100 | lr=4.36e-04 | train_loss=0.3479 train_acc=97.52% | val_loss=0.2976 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.297617 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 032/100 | lr=4.30e-04 | train_loss=0.3636 train_acc=95.70% | val_loss=0.2985 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 1/10
[THOCT] Epoch 033/100 | lr=4.24e-04 | train_loss=0.3223 train_acc=98.43% | val_loss=0.3039 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 2/10
[THOCT] Epoch 034/100 | lr=4.17e-04 | train_loss=0.3643 train_acc=95.37% | val_loss=0.3001 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 3/10
[THOCT] Epoch 035/100 | lr=4.11e-04 | train_loss=0.3140 train_acc=99.09% | val_loss=0.2993 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 4/10
[THOCT] Epoch 036/100 | lr=4.04e-04 | train_loss=0.3433 train_acc=97.60% | val_loss=0.2948 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] New best val_loss=0.294772 -> saved runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341\best_model.pth
[THOCT] Epoch 037/100 | lr=3.97e-04 | train_loss=0.3139 train_acc=99.01% | val_loss=0.2984 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 1/10
[THOCT] Epoch 038/100 | lr=3.90e-04 | train_loss=0.3546 train_acc=96.78% | val_loss=0.2968 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 2/10
[THOCT] Epoch 039/100 | lr=3.82e-04 | train_loss=0.3154 train_acc=98.84% | val_loss=0.2980 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 3/10
[THOCT] Epoch 040/100 | lr=3.75e-04 | train_loss=0.3309 train_acc=98.10% | val_loss=0.3022 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 4/10
[THOCT] Epoch 041/100 | lr=3.67e-04 | train_loss=0.3379 train_acc=97.60% | val_loss=0.2963 val_acc=100.00% val_macroF1=100.00% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 5/10
[THOCT] Epoch 042/100 | lr=3.60e-04 | train_loss=0.3277 train_acc=97.93% | val_loss=0.3006 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 6/10
[THOCT] Epoch 043/100 | lr=3.52e-04 | train_loss=0.3149 train_acc=98.93% | val_loss=0.3069 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 7/10
[THOCT] Epoch 044/100 | lr=3.44e-04 | train_loss=0.3270 train_acc=98.02% | val_loss=0.2996 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 8/10
[THOCT] Epoch 045/100 | lr=3.36e-04 | train_loss=0.3601 train_acc=96.61% | val_loss=0.3006 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 9/10
[THOCT] Epoch 046/100 | lr=3.27e-04 | train_loss=0.3102 train_acc=99.01% | val_loss=0.3004 val_acc=99.62% val_macroF1=99.62% | ep_time=1.9s peakVRAM=1.73GB
[ES] No improve 10/10
[THOCT] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.1390

------------------------------------------------------------------------------------------
[THOCT] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         AMD     0.9884    1.0000    0.9942        85
         DME     0.9886    0.9886    0.9886        88
         NOR     1.0000    0.9885    0.9942        87

    accuracy                         0.9923       260
   macro avg     0.9923    0.9924    0.9923       260
weighted avg     0.9924    0.9923    0.9923       260


==========================================================================================
[THOCT] TEST summary (uncalibrated): Acc=99.23% MacroF1=99.23% ECE=0.0704 NLL=0.0822 Brier=0.0163
[THOCT] Macro-AUC=0.9999
[THOCT] TEMP-SCALED (T=0.139): ECE=0.0067 NLL=0.0248 Brier=0.0136
[THOCT] Params trainable: 94,470 (0.4341%)
[THOCT] Adapter-only size: 0.37 MB
[THOCT] Inference latency (B=1): 13.520 ms/img (74.0 imgs/s), peakVRAM=0.10GB
[THOCT] Inference throughput (B=64): 2118.1 imgs/s, peakVRAM=0.32GB
[THOCT] Outputs saved in: runs\THOCT\deit_small_vptdeep_frozen_3c\20251224-230341
==========================================================================================

