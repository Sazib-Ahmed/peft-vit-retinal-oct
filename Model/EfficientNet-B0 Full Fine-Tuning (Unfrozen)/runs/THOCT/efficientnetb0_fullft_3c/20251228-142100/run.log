
=== DATASET RUN START: THOCT ===

[DATA] Split/Class counts:
class  AMD  DME  NOR  TOTAL
split                      
test    85   88   87    260
train  392  413  405   1210
val     84   89   87    260
[DATA] Train imbalance: min=392, max=413, ratio=1.05
[RAM] Caching split='train' images=1210 as uint8 tensors. Estimated RAM ~ 0.17 GB
[RAM] Cached 1210 images for split='train'
[RAM] Caching split='val' images=260 as uint8 tensors. Estimated RAM ~ 0.04 GB
[RAM] Cached 260 images for split='val'
[RAM] Caching split='test' images=260 as uint8 tensors. Estimated RAM ~ 0.04 GB
[RAM] Cached 260 images for split='test'
[IMB] Train class counts: [392, 413, 405]
[IMB] Class-Balanced weights (mean~1): [1.0279, 0.9766, 0.9955]
[IMB] Sampler disabled. min=392 max=413 ratio=1.05

[DATASET] THOCT
 - root: D:\AIUB\DSP\Code\Datasets\THOCT1800\THOCT1800_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (3): ['AMD', 'DME', 'NOR']
 - split sizes: train=1210 val=260 test=260

[MODEL] Creating efficientnet_b0 (FULL fine-tuning, unfrozen)
[PARAMS] total=4,011,391 trainable=4,011,391 (100.00%)
[IMB] Train class counts: [392, 413, 405]
[IMB] Class-Balanced weights (mean~1): [1.0279, 0.9766, 0.9955]
[IMB] Sampler disabled. min=392 max=413 ratio=1.05
[THOCT] Epoch 001/100 | lr=1.00e-04 | train_loss=2.3917 train_acc=44.71% | val_loss=1.6369 val_acc=49.62% val_macroF1=47.60% | ep_time=12.3s peakVRAM=2.78GB
[ES] New best val_loss=1.636882 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 002/100 | lr=1.50e-04 | train_loss=1.3426 train_acc=71.82% | val_loss=1.3874 val_acc=56.15% val_macroF1=56.30% | ep_time=1.8s peakVRAM=2.79GB
[ES] New best val_loss=1.387441 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 003/100 | lr=2.00e-04 | train_loss=0.9327 train_acc=80.99% | val_loss=1.2579 val_acc=68.08% val_macroF1=66.94% | ep_time=1.8s peakVRAM=2.79GB
[ES] New best val_loss=1.257858 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 004/100 | lr=2.50e-04 | train_loss=0.8823 train_acc=82.48% | val_loss=0.9945 val_acc=75.38% val_macroF1=75.36% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.994517 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 005/100 | lr=3.00e-04 | train_loss=0.8244 train_acc=80.99% | val_loss=1.0560 val_acc=74.23% val_macroF1=72.67% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 006/100 | lr=3.50e-04 | train_loss=0.9268 train_acc=82.31% | val_loss=0.8679 val_acc=88.08% val_macroF1=88.03% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.867873 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 007/100 | lr=4.00e-04 | train_loss=0.9291 train_acc=78.51% | val_loss=0.9610 val_acc=73.46% val_macroF1=71.86% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 008/100 | lr=4.50e-04 | train_loss=0.7585 train_acc=86.28% | val_loss=0.7323 val_acc=80.38% val_macroF1=80.32% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.732299 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 009/100 | lr=5.00e-04 | train_loss=0.7432 train_acc=84.55% | val_loss=0.9373 val_acc=78.46% val_macroF1=77.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 010/100 | lr=5.00e-04 | train_loss=0.6918 train_acc=86.61% | val_loss=0.7721 val_acc=89.23% val_macroF1=89.13% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 011/100 | lr=5.00e-04 | train_loss=0.5613 train_acc=90.25% | val_loss=0.7932 val_acc=89.62% val_macroF1=89.82% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 3/10
[THOCT] Epoch 012/100 | lr=4.99e-04 | train_loss=0.6362 train_acc=87.11% | val_loss=0.4245 val_acc=96.15% val_macroF1=96.17% | ep_time=1.8s peakVRAM=2.79GB
[ES] New best val_loss=0.424509 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 013/100 | lr=4.99e-04 | train_loss=0.5375 train_acc=90.41% | val_loss=0.4930 val_acc=95.77% val_macroF1=95.77% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 014/100 | lr=4.98e-04 | train_loss=0.4008 train_acc=96.36% | val_loss=0.4382 val_acc=94.62% val_macroF1=94.53% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 015/100 | lr=4.96e-04 | train_loss=0.4843 train_acc=89.83% | val_loss=0.3386 val_acc=99.23% val_macroF1=99.23% | ep_time=1.8s peakVRAM=2.79GB
[ES] New best val_loss=0.338645 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 016/100 | lr=4.95e-04 | train_loss=0.4637 train_acc=94.21% | val_loss=0.3437 val_acc=99.23% val_macroF1=99.24% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 017/100 | lr=4.93e-04 | train_loss=0.3424 train_acc=98.60% | val_loss=0.3832 val_acc=99.23% val_macroF1=99.23% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 018/100 | lr=4.90e-04 | train_loss=0.3733 train_acc=96.86% | val_loss=0.4010 val_acc=98.08% val_macroF1=98.08% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 3/10
[THOCT] Epoch 019/100 | lr=4.88e-04 | train_loss=0.3396 train_acc=97.77% | val_loss=0.3083 val_acc=98.85% val_macroF1=98.84% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.308318 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 020/100 | lr=4.85e-04 | train_loss=0.3959 train_acc=95.54% | val_loss=0.3125 val_acc=99.23% val_macroF1=99.23% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 021/100 | lr=4.82e-04 | train_loss=0.4287 train_acc=92.98% | val_loss=0.3203 val_acc=99.23% val_macroF1=99.23% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 022/100 | lr=4.78e-04 | train_loss=0.3382 train_acc=98.18% | val_loss=0.3052 val_acc=99.23% val_macroF1=99.23% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.305177 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 023/100 | lr=4.75e-04 | train_loss=0.3692 train_acc=96.20% | val_loss=0.3119 val_acc=99.62% val_macroF1=99.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 024/100 | lr=4.71e-04 | train_loss=0.3330 train_acc=98.60% | val_loss=0.3044 val_acc=100.00% val_macroF1=100.00% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.304362 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 025/100 | lr=4.67e-04 | train_loss=0.3425 train_acc=98.02% | val_loss=0.3010 val_acc=99.62% val_macroF1=99.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.300967 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 026/100 | lr=4.62e-04 | train_loss=0.3301 train_acc=98.60% | val_loss=0.3111 val_acc=99.23% val_macroF1=99.24% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 027/100 | lr=4.57e-04 | train_loss=0.3429 train_acc=97.52% | val_loss=0.3079 val_acc=99.62% val_macroF1=99.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 028/100 | lr=4.52e-04 | train_loss=0.3376 train_acc=98.02% | val_loss=0.2976 val_acc=100.00% val_macroF1=100.00% | ep_time=1.8s peakVRAM=2.79GB
[ES] New best val_loss=0.297555 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 029/100 | lr=4.47e-04 | train_loss=0.3028 train_acc=99.75% | val_loss=0.3026 val_acc=99.23% val_macroF1=99.24% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 030/100 | lr=4.42e-04 | train_loss=0.3126 train_acc=99.09% | val_loss=0.3046 val_acc=99.23% val_macroF1=99.23% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 031/100 | lr=4.36e-04 | train_loss=0.3435 train_acc=97.36% | val_loss=0.3204 val_acc=98.85% val_macroF1=98.84% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 3/10
[THOCT] Epoch 032/100 | lr=4.30e-04 | train_loss=0.3253 train_acc=99.09% | val_loss=0.3150 val_acc=98.85% val_macroF1=98.84% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 4/10
[THOCT] Epoch 033/100 | lr=4.24e-04 | train_loss=0.3451 train_acc=97.36% | val_loss=0.3313 val_acc=98.85% val_macroF1=98.85% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 5/10
[THOCT] Epoch 034/100 | lr=4.17e-04 | train_loss=0.3091 train_acc=99.42% | val_loss=0.3078 val_acc=99.23% val_macroF1=99.24% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 6/10
[THOCT] Epoch 035/100 | lr=4.11e-04 | train_loss=0.3237 train_acc=98.43% | val_loss=0.3021 val_acc=99.62% val_macroF1=99.62% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 7/10
[THOCT] Epoch 036/100 | lr=4.04e-04 | train_loss=0.3422 train_acc=98.10% | val_loss=0.2942 val_acc=100.00% val_macroF1=100.00% | ep_time=1.7s peakVRAM=2.79GB
[ES] New best val_loss=0.294196 -> saved runs\THOCT\efficientnetb0_fullft_3c\20251228-142100\best_model.pth
[THOCT] Epoch 037/100 | lr=3.97e-04 | train_loss=0.3068 train_acc=99.50% | val_loss=0.3017 val_acc=99.23% val_macroF1=99.23% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 1/10
[THOCT] Epoch 038/100 | lr=3.90e-04 | train_loss=0.3442 train_acc=97.44% | val_loss=0.2981 val_acc=99.62% val_macroF1=99.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 2/10
[THOCT] Epoch 039/100 | lr=3.82e-04 | train_loss=0.3340 train_acc=97.77% | val_loss=0.2954 val_acc=100.00% val_macroF1=100.00% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 3/10
[THOCT] Epoch 040/100 | lr=3.75e-04 | train_loss=0.3078 train_acc=99.34% | val_loss=0.2967 val_acc=100.00% val_macroF1=100.00% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 4/10
[THOCT] Epoch 041/100 | lr=3.67e-04 | train_loss=0.3200 train_acc=98.68% | val_loss=0.2996 val_acc=99.62% val_macroF1=99.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 5/10
[THOCT] Epoch 042/100 | lr=3.60e-04 | train_loss=0.3205 train_acc=98.76% | val_loss=0.3032 val_acc=99.62% val_macroF1=99.61% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 6/10
[THOCT] Epoch 043/100 | lr=3.52e-04 | train_loss=0.3097 train_acc=99.17% | val_loss=0.2971 val_acc=100.00% val_macroF1=100.00% | ep_time=1.7s peakVRAM=2.79GB
[ES] No improve 7/10
[THOCT] Epoch 044/100 | lr=3.44e-04 | train_loss=0.3650 train_acc=96.12% | val_loss=0.3032 val_acc=99.62% val_macroF1=99.61% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 8/10
[THOCT] Epoch 045/100 | lr=3.36e-04 | train_loss=0.3436 train_acc=97.02% | val_loss=0.3172 val_acc=99.23% val_macroF1=99.23% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 9/10
[THOCT] Epoch 046/100 | lr=3.27e-04 | train_loss=0.3024 train_acc=99.75% | val_loss=0.3213 val_acc=99.23% val_macroF1=99.23% | ep_time=1.8s peakVRAM=2.79GB
[ES] No improve 10/10
[THOCT] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.2848

------------------------------------------------------------------------------------------
[THOCT] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         AMD     1.0000    1.0000    1.0000        85
         DME     1.0000    1.0000    1.0000        88
         NOR     1.0000    1.0000    1.0000        87

    accuracy                         1.0000       260
   macro avg     1.0000    1.0000    1.0000       260
weighted avg     1.0000    1.0000    1.0000       260


==========================================================================================
[THOCT] TEST summary (uncalibrated): Acc=100.00% MacroF1=100.00% ECE=0.0677 NLL=0.0705 Brier=0.0079
[THOCT] Macro-AUC=1.0000
[THOCT] TEMP-SCALED (T=0.285): ECE=0.0001 NLL=0.0001 Brier=0.0000
[THOCT] Params trainable: 4,011,391 (100.00%)
[THOCT] Inference latency (B=1): 16.257 ms/img (61.5 imgs/s), peakVRAM=0.06GB
[THOCT] Inference throughput (B=64): 3622.4 imgs/s, peakVRAM=0.45GB
[THOCT] Outputs saved in: runs\THOCT\efficientnetb0_fullft_3c\20251228-142100
==========================================================================================

