
=== DATASET RUN START: NEH_UT_2021 ===

[DATA] Split/Class counts:
class   CNV  DRUSEN  NORMAL  TOTAL
split                             
test    544     687    1292   2523
train  2188    3525    5791  11504
val     471     690    1475   2636
[DATA] Train imbalance: min=2188, max=5791, ratio=2.65
[RAM] Caching split='train' images=11504 as uint8 tensors. Estimated RAM ~ 1.61 GB
[RAM] Cached 11504 images for split='train'
[RAM] Caching split='val' images=2636 as uint8 tensors. Estimated RAM ~ 0.37 GB
[RAM] Cached 2636 images for split='val'
[RAM] Caching split='test' images=2523 as uint8 tensors. Estimated RAM ~ 0.35 GB
[RAM] Cached 2523 images for split='test'
[IMB] Train class counts: [2188, 3525, 5791]
[IMB] Class-Balanced weights (mean~1): [1.4228, 0.9412, 0.636]
[IMB] Sampler disabled. min=2188 max=5791 ratio=2.65

[DATASET] NEH_UT_2021
 - root: D:\AIUB\DSP\Code\Datasets\NEH_UT_2021RetinalOCTDataset\NEH_UT_2021RetinalOCTDataset_V2_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (3): ['CNV', 'DRUSEN', 'NORMAL']
 - split sizes: train=11504 val=2636 test=2523

[MODEL] Creating resnet50 (FULL fine-tuning, unfrozen)
[PARAMS] total=23,514,179 trainable=23,514,179 (100.00%)
[IMB] Train class counts: [2188, 3525, 5791]
[IMB] Class-Balanced weights (mean~1): [1.4228, 0.9412, 0.636]
[IMB] Sampler disabled. min=2188 max=5791 ratio=2.65
[NEH_UT_2021] Epoch 001/100 | lr=1.00e-04 | train_loss=1.0886 train_acc=51.09% | val_loss=1.0239 val_acc=66.65% val_macroF1=53.28% | ep_time=27.7s peakVRAM=3.55GB
[ES] New best val_loss=1.023917 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 002/100 | lr=1.50e-04 | train_loss=0.8721 train_acc=66.16% | val_loss=0.8928 val_acc=61.72% val_macroF1=62.04% | ep_time=26.5s peakVRAM=3.02GB
[ES] New best val_loss=0.892754 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 003/100 | lr=2.00e-04 | train_loss=0.6956 train_acc=77.88% | val_loss=0.6076 val_acc=87.14% val_macroF1=85.28% | ep_time=26.5s peakVRAM=3.02GB
[ES] New best val_loss=0.607603 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 004/100 | lr=2.50e-04 | train_loss=0.6523 train_acc=80.94% | val_loss=0.5894 val_acc=88.69% val_macroF1=87.31% | ep_time=26.4s peakVRAM=3.02GB
[ES] New best val_loss=0.589389 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 005/100 | lr=3.00e-04 | train_loss=0.5997 train_acc=84.22% | val_loss=0.5661 val_acc=89.42% val_macroF1=89.10% | ep_time=26.4s peakVRAM=3.02GB
[ES] New best val_loss=0.566070 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 006/100 | lr=3.50e-04 | train_loss=0.5904 train_acc=84.68% | val_loss=0.5774 val_acc=89.87% val_macroF1=88.66% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 007/100 | lr=4.00e-04 | train_loss=0.5825 train_acc=84.94% | val_loss=0.5548 val_acc=90.74% val_macroF1=90.20% | ep_time=26.5s peakVRAM=3.02GB
[ES] New best val_loss=0.554812 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 008/100 | lr=4.50e-04 | train_loss=0.5737 train_acc=85.74% | val_loss=0.5954 val_acc=87.82% val_macroF1=86.03% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 009/100 | lr=5.00e-04 | train_loss=0.5713 train_acc=85.94% | val_loss=0.5704 val_acc=90.55% val_macroF1=89.95% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 010/100 | lr=5.00e-04 | train_loss=0.5566 train_acc=86.58% | val_loss=0.5520 val_acc=90.33% val_macroF1=89.33% | ep_time=26.4s peakVRAM=3.02GB
[ES] New best val_loss=0.551971 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 011/100 | lr=5.00e-04 | train_loss=0.5383 train_acc=87.19% | val_loss=0.5728 val_acc=89.45% val_macroF1=88.71% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 012/100 | lr=4.99e-04 | train_loss=0.5383 train_acc=87.50% | val_loss=0.5591 val_acc=90.06% val_macroF1=89.31% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 013/100 | lr=4.99e-04 | train_loss=0.5231 train_acc=88.60% | val_loss=0.6295 val_acc=88.01% val_macroF1=86.84% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 3/10
[NEH_UT_2021] Epoch 014/100 | lr=4.98e-04 | train_loss=0.4994 train_acc=89.86% | val_loss=0.5770 val_acc=90.10% val_macroF1=89.12% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 4/10
[NEH_UT_2021] Epoch 015/100 | lr=4.96e-04 | train_loss=0.4971 train_acc=90.21% | val_loss=0.5507 val_acc=90.82% val_macroF1=90.13% | ep_time=26.5s peakVRAM=3.02GB
[ES] New best val_loss=0.550720 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 016/100 | lr=4.95e-04 | train_loss=0.5005 train_acc=89.52% | val_loss=0.5319 val_acc=91.65% val_macroF1=91.30% | ep_time=26.5s peakVRAM=3.02GB
[ES] New best val_loss=0.531883 -> saved runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141\best_model.pth
[NEH_UT_2021] Epoch 017/100 | lr=4.93e-04 | train_loss=0.4814 train_acc=90.86% | val_loss=0.5555 val_acc=90.78% val_macroF1=90.10% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 1/10
[NEH_UT_2021] Epoch 018/100 | lr=4.90e-04 | train_loss=0.4801 train_acc=91.12% | val_loss=0.5746 val_acc=89.68% val_macroF1=88.77% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 2/10
[NEH_UT_2021] Epoch 019/100 | lr=4.88e-04 | train_loss=0.4792 train_acc=90.86% | val_loss=0.5767 val_acc=89.00% val_macroF1=88.77% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 3/10
[NEH_UT_2021] Epoch 020/100 | lr=4.85e-04 | train_loss=0.4812 train_acc=90.99% | val_loss=0.6926 val_acc=87.03% val_macroF1=85.30% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 4/10
[NEH_UT_2021] Epoch 021/100 | lr=4.82e-04 | train_loss=0.4724 train_acc=91.78% | val_loss=0.5726 val_acc=90.17% val_macroF1=89.63% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 5/10
[NEH_UT_2021] Epoch 022/100 | lr=4.78e-04 | train_loss=0.4502 train_acc=92.62% | val_loss=0.6085 val_acc=88.62% val_macroF1=87.48% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 6/10
[NEH_UT_2021] Epoch 023/100 | lr=4.75e-04 | train_loss=0.4587 train_acc=92.03% | val_loss=0.6245 val_acc=88.69% val_macroF1=87.44% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 7/10
[NEH_UT_2021] Epoch 024/100 | lr=4.71e-04 | train_loss=0.4595 train_acc=92.25% | val_loss=0.6187 val_acc=88.32% val_macroF1=87.13% | ep_time=26.5s peakVRAM=3.02GB
[ES] No improve 8/10
[NEH_UT_2021] Epoch 025/100 | lr=4.67e-04 | train_loss=0.4590 train_acc=92.32% | val_loss=0.5949 val_acc=89.00% val_macroF1=87.84% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 9/10
[NEH_UT_2021] Epoch 026/100 | lr=4.62e-04 | train_loss=0.4564 train_acc=92.42% | val_loss=0.5688 val_acc=90.33% val_macroF1=89.60% | ep_time=26.4s peakVRAM=3.02GB
[ES] No improve 10/10
[NEH_UT_2021] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.6573

------------------------------------------------------------------------------------------
[NEH_UT_2021] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         CNV     0.9409    0.9357    0.9382       544
      DRUSEN     0.8772    0.8108    0.8427       687
      NORMAL     0.9176    0.9567    0.9367      1292

    accuracy                         0.9124      2523
   macro avg     0.9119    0.9010    0.9059      2523
weighted avg     0.9116    0.9124    0.9114      2523


==========================================================================================
[NEH_UT_2021] TEST summary (uncalibrated): Acc=91.24% MacroF1=90.59% ECE=0.0830 NLL=0.3093 Brier=0.1470
[NEH_UT_2021] Macro-AUC=0.9724
[NEH_UT_2021] TEMP-SCALED (T=0.657): ECE=0.0130 NLL=0.2718 Brier=0.1366
[NEH_UT_2021] Params trainable: 23,514,179 (100.00%)
[NEH_UT_2021] Inference latency (B=1): 12.020 ms/img (83.2 imgs/s), peakVRAM=0.24GB
[NEH_UT_2021] Inference throughput (B=64): 1446.0 imgs/s, peakVRAM=0.60GB
[NEH_UT_2021] Outputs saved in: runs\NEH_UT_2021\resnet50_fullft_3c\20251224-183141
==========================================================================================

