
=== DATASET RUN START: OCT2017 ===

[DATA] Split/Class counts:
class    CNV   DME  DRUSEN  NORMAL  TOTAL
split                                    
test     250   250     250     250   1000
train  28285  9819    7000   45054  90158
val     3142  1091     777    5006  10016
[DATA] Train imbalance: min=7000, max=45054, ratio=6.44
[RAM] Caching split='train' images=90158 as uint8 tensors. Estimated RAM ~ 12.64 GB
[RAM] Cached 90158 images for split='train'
[RAM] Caching split='val' images=10016 as uint8 tensors. Estimated RAM ~ 1.40 GB
[RAM] Cached 10016 images for split='val'
[RAM] Caching split='test' images=1000 as uint8 tensors. Estimated RAM ~ 0.14 GB
[RAM] Cached 1000 images for split='test'
[IMB] Train class counts: [28285, 9819, 7000, 45054]
[IMB] Class-Balanced weights (mean~1): [0.7512, 1.1301, 1.404, 0.7147]
[IMB] Sampler disabled. min=7000 max=45054 ratio=6.44

[DATASET] OCT2017
 - root: D:\AIUB\DSP\Code\Datasets\ZhangLabData\OCT2017_CLEAN_SHAONLY
 - pad_to_square: True
 - cache_in_ram: True
 - classes (4): ['CNV', 'DME', 'DRUSEN', 'NORMAL']
 - split sizes: train=90158 val=10016 test=1000

[MODEL] Creating resnet50 (FULL fine-tuning, unfrozen)
[PARAMS] total=23,516,228 trainable=23,516,228 (100.00%)
[IMB] Train class counts: [28285, 9819, 7000, 45054]
[IMB] Class-Balanced weights (mean~1): [0.7512, 1.1301, 1.404, 0.7147]
[IMB] Sampler disabled. min=7000 max=45054 ratio=6.44
[OCT2017] Epoch 001/100 | lr=1.00e-04 | train_loss=0.8570 train_acc=79.31% | val_loss=0.5659 val_acc=93.56% val_macroF1=89.21% | ep_time=213.5s peakVRAM=4.09GB
[ES] New best val_loss=0.565886 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 002/100 | lr=1.50e-04 | train_loss=0.5996 train_acc=92.37% | val_loss=0.5668 val_acc=93.31% val_macroF1=89.21% | ep_time=208.4s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 003/100 | lr=2.00e-04 | train_loss=0.5629 train_acc=93.84% | val_loss=0.5268 val_acc=95.47% val_macroF1=92.42% | ep_time=206.8s peakVRAM=3.02GB
[ES] New best val_loss=0.526758 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 004/100 | lr=2.50e-04 | train_loss=0.5434 train_acc=94.63% | val_loss=0.4946 val_acc=97.34% val_macroF1=95.40% | ep_time=206.5s peakVRAM=3.02GB
[ES] New best val_loss=0.494592 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 005/100 | lr=3.00e-04 | train_loss=0.5299 train_acc=95.26% | val_loss=0.5083 val_acc=96.16% val_macroF1=93.45% | ep_time=206.5s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 006/100 | lr=3.50e-04 | train_loss=0.5231 train_acc=95.61% | val_loss=0.5079 val_acc=96.37% val_macroF1=93.71% | ep_time=206.2s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 007/100 | lr=4.00e-04 | train_loss=0.5225 train_acc=95.58% | val_loss=0.4860 val_acc=97.62% val_macroF1=95.71% | ep_time=206.3s peakVRAM=3.02GB
[ES] New best val_loss=0.485977 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 008/100 | lr=4.50e-04 | train_loss=0.5165 train_acc=95.82% | val_loss=0.5106 val_acc=96.15% val_macroF1=93.35% | ep_time=206.4s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 009/100 | lr=5.00e-04 | train_loss=0.5124 train_acc=95.90% | val_loss=0.4919 val_acc=97.43% val_macroF1=95.50% | ep_time=206.1s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 010/100 | lr=5.00e-04 | train_loss=0.5088 train_acc=96.15% | val_loss=0.4952 val_acc=97.00% val_macroF1=94.76% | ep_time=208.3s peakVRAM=3.02GB
[ES] No improve 3/10
[OCT2017] Epoch 011/100 | lr=5.00e-04 | train_loss=0.5057 train_acc=96.30% | val_loss=0.4905 val_acc=97.38% val_macroF1=95.42% | ep_time=214.6s peakVRAM=3.02GB
[ES] No improve 4/10
[OCT2017] Epoch 012/100 | lr=4.99e-04 | train_loss=0.5004 train_acc=96.50% | val_loss=0.4892 val_acc=97.50% val_macroF1=95.58% | ep_time=216.4s peakVRAM=3.02GB
[ES] No improve 5/10
[OCT2017] Epoch 013/100 | lr=4.99e-04 | train_loss=0.5029 train_acc=96.40% | val_loss=0.5291 val_acc=95.28% val_macroF1=92.09% | ep_time=217.8s peakVRAM=3.02GB
[ES] No improve 6/10
[OCT2017] Epoch 014/100 | lr=4.98e-04 | train_loss=0.4952 train_acc=96.75% | val_loss=0.4789 val_acc=98.00% val_macroF1=96.46% | ep_time=216.8s peakVRAM=3.02GB
[ES] New best val_loss=0.478925 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 015/100 | lr=4.96e-04 | train_loss=0.4965 train_acc=96.67% | val_loss=0.4939 val_acc=97.50% val_macroF1=95.55% | ep_time=214.7s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 016/100 | lr=4.95e-04 | train_loss=0.4895 train_acc=97.00% | val_loss=0.4874 val_acc=97.59% val_macroF1=95.74% | ep_time=212.0s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 017/100 | lr=4.93e-04 | train_loss=0.4884 train_acc=97.02% | val_loss=0.4785 val_acc=98.04% val_macroF1=96.45% | ep_time=210.0s peakVRAM=3.02GB
[ES] New best val_loss=0.478485 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 018/100 | lr=4.90e-04 | train_loss=0.4834 train_acc=97.23% | val_loss=0.4900 val_acc=97.41% val_macroF1=95.48% | ep_time=211.5s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 019/100 | lr=4.88e-04 | train_loss=0.4851 train_acc=97.19% | val_loss=0.4731 val_acc=98.21% val_macroF1=96.74% | ep_time=217.9s peakVRAM=3.02GB
[ES] New best val_loss=0.473078 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 020/100 | lr=4.85e-04 | train_loss=0.4828 train_acc=97.25% | val_loss=0.4723 val_acc=98.34% val_macroF1=96.96% | ep_time=217.7s peakVRAM=3.02GB
[ES] New best val_loss=0.472301 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 021/100 | lr=4.82e-04 | train_loss=0.4804 train_acc=97.39% | val_loss=0.4757 val_acc=98.23% val_macroF1=96.83% | ep_time=216.9s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 022/100 | lr=4.78e-04 | train_loss=0.4789 train_acc=97.42% | val_loss=0.4720 val_acc=98.36% val_macroF1=97.01% | ep_time=217.4s peakVRAM=3.02GB
[ES] New best val_loss=0.471983 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 023/100 | lr=4.75e-04 | train_loss=0.4773 train_acc=97.48% | val_loss=0.4765 val_acc=98.15% val_macroF1=96.70% | ep_time=216.1s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 024/100 | lr=4.71e-04 | train_loss=0.4772 train_acc=97.48% | val_loss=0.4800 val_acc=97.95% val_macroF1=96.48% | ep_time=211.3s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 025/100 | lr=4.67e-04 | train_loss=0.4743 train_acc=97.62% | val_loss=0.4733 val_acc=98.31% val_macroF1=96.95% | ep_time=214.3s peakVRAM=3.02GB
[ES] No improve 3/10
[OCT2017] Epoch 026/100 | lr=4.62e-04 | train_loss=0.4751 train_acc=97.58% | val_loss=0.4713 val_acc=98.34% val_macroF1=97.03% | ep_time=217.1s peakVRAM=3.02GB
[ES] New best val_loss=0.471317 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 027/100 | lr=4.57e-04 | train_loss=0.4708 train_acc=97.79% | val_loss=0.4690 val_acc=98.47% val_macroF1=97.24% | ep_time=217.1s peakVRAM=3.02GB
[ES] New best val_loss=0.469037 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 028/100 | lr=4.52e-04 | train_loss=0.4728 train_acc=97.69% | val_loss=0.4745 val_acc=98.42% val_macroF1=97.17% | ep_time=215.1s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 029/100 | lr=4.47e-04 | train_loss=0.4699 train_acc=97.83% | val_loss=0.4782 val_acc=98.15% val_macroF1=96.72% | ep_time=208.5s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 030/100 | lr=4.42e-04 | train_loss=0.4696 train_acc=97.83% | val_loss=0.4737 val_acc=98.29% val_macroF1=96.98% | ep_time=209.9s peakVRAM=3.02GB
[ES] No improve 3/10
[OCT2017] Epoch 031/100 | lr=4.36e-04 | train_loss=0.4692 train_acc=97.87% | val_loss=0.4738 val_acc=98.35% val_macroF1=97.03% | ep_time=212.3s peakVRAM=3.02GB
[ES] No improve 4/10
[OCT2017] Epoch 032/100 | lr=4.30e-04 | train_loss=0.4634 train_acc=98.09% | val_loss=0.4675 val_acc=98.48% val_macroF1=97.32% | ep_time=211.8s peakVRAM=3.02GB
[ES] New best val_loss=0.467461 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 033/100 | lr=4.24e-04 | train_loss=0.4671 train_acc=97.95% | val_loss=0.4681 val_acc=98.61% val_macroF1=97.54% | ep_time=209.9s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 034/100 | lr=4.17e-04 | train_loss=0.4645 train_acc=98.04% | val_loss=0.4717 val_acc=98.39% val_macroF1=97.16% | ep_time=210.4s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 035/100 | lr=4.11e-04 | train_loss=0.4636 train_acc=98.04% | val_loss=0.4754 val_acc=98.20% val_macroF1=96.90% | ep_time=209.8s peakVRAM=3.02GB
[ES] No improve 3/10
[OCT2017] Epoch 036/100 | lr=4.04e-04 | train_loss=0.4638 train_acc=98.08% | val_loss=0.4777 val_acc=98.17% val_macroF1=96.80% | ep_time=210.1s peakVRAM=3.02GB
[ES] No improve 4/10
[OCT2017] Epoch 037/100 | lr=3.97e-04 | train_loss=0.4621 train_acc=98.14% | val_loss=0.4761 val_acc=98.25% val_macroF1=96.86% | ep_time=209.8s peakVRAM=3.02GB
[ES] No improve 5/10
[OCT2017] Epoch 038/100 | lr=3.90e-04 | train_loss=0.4631 train_acc=98.08% | val_loss=0.4679 val_acc=98.61% val_macroF1=97.47% | ep_time=209.3s peakVRAM=3.02GB
[ES] No improve 6/10
[OCT2017] Epoch 039/100 | lr=3.82e-04 | train_loss=0.4614 train_acc=98.15% | val_loss=0.4651 val_acc=98.73% val_macroF1=97.76% | ep_time=208.0s peakVRAM=3.02GB
[ES] New best val_loss=0.465108 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 040/100 | lr=3.75e-04 | train_loss=0.4596 train_acc=98.26% | val_loss=0.4677 val_acc=98.63% val_macroF1=97.54% | ep_time=208.4s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 041/100 | lr=3.67e-04 | train_loss=0.4606 train_acc=98.23% | val_loss=0.4688 val_acc=98.58% val_macroF1=97.41% | ep_time=209.2s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 042/100 | lr=3.60e-04 | train_loss=0.4614 train_acc=98.18% | val_loss=0.4685 val_acc=98.54% val_macroF1=97.40% | ep_time=209.4s peakVRAM=3.02GB
[ES] No improve 3/10
[OCT2017] Epoch 043/100 | lr=3.52e-04 | train_loss=0.4578 train_acc=98.34% | val_loss=0.4700 val_acc=98.45% val_macroF1=97.27% | ep_time=210.9s peakVRAM=3.02GB
[ES] No improve 4/10
[OCT2017] Epoch 044/100 | lr=3.44e-04 | train_loss=0.4577 train_acc=98.31% | val_loss=0.4656 val_acc=98.71% val_macroF1=97.67% | ep_time=210.9s peakVRAM=3.02GB
[ES] No improve 5/10
[OCT2017] Epoch 045/100 | lr=3.36e-04 | train_loss=0.4573 train_acc=98.39% | val_loss=0.4676 val_acc=98.72% val_macroF1=97.65% | ep_time=211.2s peakVRAM=3.02GB
[ES] No improve 6/10
[OCT2017] Epoch 046/100 | lr=3.27e-04 | train_loss=0.4580 train_acc=98.38% | val_loss=0.4679 val_acc=98.66% val_macroF1=97.58% | ep_time=210.1s peakVRAM=3.02GB
[ES] No improve 7/10
[OCT2017] Epoch 047/100 | lr=3.19e-04 | train_loss=0.4532 train_acc=98.49% | val_loss=0.4676 val_acc=98.67% val_macroF1=97.62% | ep_time=209.9s peakVRAM=3.02GB
[ES] No improve 8/10
[OCT2017] Epoch 048/100 | lr=3.10e-04 | train_loss=0.4541 train_acc=98.51% | val_loss=0.4670 val_acc=98.68% val_macroF1=97.64% | ep_time=210.1s peakVRAM=3.02GB
[ES] No improve 9/10
[OCT2017] Epoch 049/100 | lr=3.02e-04 | train_loss=0.4535 train_acc=98.48% | val_loss=0.4643 val_acc=98.73% val_macroF1=97.71% | ep_time=208.8s peakVRAM=3.02GB
[ES] New best val_loss=0.464263 -> saved runs\OCT2017\resnet50_fullft_4c\20251225-235341\best_model.pth
[OCT2017] Epoch 050/100 | lr=2.93e-04 | train_loss=0.4536 train_acc=98.53% | val_loss=0.4655 val_acc=98.70% val_macroF1=97.67% | ep_time=209.5s peakVRAM=3.02GB
[ES] No improve 1/10
[OCT2017] Epoch 051/100 | lr=2.85e-04 | train_loss=0.4505 train_acc=98.61% | val_loss=0.4679 val_acc=98.65% val_macroF1=97.58% | ep_time=207.6s peakVRAM=3.02GB
[ES] No improve 2/10
[OCT2017] Epoch 052/100 | lr=2.76e-04 | train_loss=0.4521 train_acc=98.57% | val_loss=0.4660 val_acc=98.65% val_macroF1=97.55% | ep_time=207.5s peakVRAM=3.02GB
[ES] No improve 3/10
[OCT2017] Epoch 053/100 | lr=2.67e-04 | train_loss=0.4514 train_acc=98.59% | val_loss=0.4674 val_acc=98.57% val_macroF1=97.41% | ep_time=207.7s peakVRAM=3.02GB
[ES] No improve 4/10
[OCT2017] Epoch 054/100 | lr=2.59e-04 | train_loss=0.4480 train_acc=98.75% | val_loss=0.4645 val_acc=98.76% val_macroF1=97.76% | ep_time=207.5s peakVRAM=3.02GB
[ES] No improve 5/10
[OCT2017] Epoch 055/100 | lr=2.50e-04 | train_loss=0.4524 train_acc=98.56% | val_loss=0.4705 val_acc=98.49% val_macroF1=97.34% | ep_time=207.5s peakVRAM=3.02GB
[ES] No improve 6/10
[OCT2017] Epoch 056/100 | lr=2.41e-04 | train_loss=0.4474 train_acc=98.78% | val_loss=0.4649 val_acc=98.72% val_macroF1=97.72% | ep_time=208.4s peakVRAM=3.02GB
[ES] No improve 7/10
[OCT2017] Epoch 057/100 | lr=2.33e-04 | train_loss=0.4473 train_acc=98.76% | val_loss=0.4662 val_acc=98.77% val_macroF1=97.81% | ep_time=208.4s peakVRAM=3.02GB
[ES] No improve 8/10
[OCT2017] Epoch 058/100 | lr=2.24e-04 | train_loss=0.4473 train_acc=98.79% | val_loss=0.4652 val_acc=98.75% val_macroF1=97.75% | ep_time=208.3s peakVRAM=3.02GB
[ES] No improve 9/10
[OCT2017] Epoch 059/100 | lr=2.15e-04 | train_loss=0.4461 train_acc=98.85% | val_loss=0.4685 val_acc=98.65% val_macroF1=97.61% | ep_time=208.3s peakVRAM=3.02GB
[ES] No improve 10/10
[OCT2017] Early stopping triggered.
[CAL] Fitting temperature scaling on VAL set...
[CAL] Learned temperature T = 0.5388

------------------------------------------------------------------------------------------
[OCT2017] TEST classification report (uncalibrated)
------------------------------------------------------------------------------------------
              precision    recall  f1-score   support

         CNV     0.8013    1.0000    0.8897       250
         DME     0.9959    0.9600    0.9776       250
      DRUSEN     1.0000    0.7760    0.8739       250
      NORMAL     0.9842    0.9960    0.9901       250

    accuracy                         0.9330      1000
   macro avg     0.9453    0.9330    0.9328      1000
weighted avg     0.9453    0.9330    0.9328      1000


==========================================================================================
[OCT2017] TEST summary (uncalibrated): Acc=93.30% MacroF1=93.28% ECE=0.0750 NLL=0.2269 Brier=0.1003
[OCT2017] Macro-AUC=0.9920
[OCT2017] TEMP-SCALED (T=0.539): ECE=0.0505 NLL=0.2392 Brier=0.1093
[OCT2017] Params trainable: 23,516,228 (100.00%)
[OCT2017] Inference latency (B=1): 12.432 ms/img (80.4 imgs/s), peakVRAM=0.25GB
[OCT2017] Inference throughput (B=64): 1418.3 imgs/s, peakVRAM=0.60GB
[OCT2017] Outputs saved in: runs\OCT2017\resnet50_fullft_4c\20251225-235341
==========================================================================================

